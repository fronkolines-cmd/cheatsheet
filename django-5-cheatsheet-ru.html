<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Django 5.0+ ‚Äî –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º –∏ API</title>
  <!-- Tailwind CSS v4 via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- highlight.js (dark theme) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <style>
    :root { color-scheme: dark; }
    body { background: #0b1220; color: #dbe7ff; }
    .section-card { background: #0f172a; border: 1px solid #1e293b; border-radius: 0.75rem; }
    .code-block pre { background: #0b1220 !important; margin: 0 !important; border-radius: 0.5rem; }
    .copy-btn { opacity: 0; transition: opacity 0.15s ease; }
    .code-block:hover .copy-btn { opacity: 1; }
    #toc { scrollbar-width: thin; scrollbar-color: #475569 #0b1220; }
    #toc::-webkit-scrollbar { width: 6px; }
    #toc::-webkit-scrollbar-track { background: #0b1220; border-radius: 4px; }
    #toc::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    #toc::-webkit-scrollbar-thumb:hover { background: #475569; }
    @media (max-width: 1024px) { #toc { display: none; } }
  </style>
</head>
<body class="font-sans antialiased">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-[#0b1220]/90 backdrop-blur border-b border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex flex-col sm:flex-row items-center gap-3 justify-between">
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">
            <span class="bg-gradient-to-r from-sky-400 to-purple-400 bg-clip-text text-transparent">Django 5.0+ ‚Äî –®–ø–∞—Ä–≥–∞–ª–∫–∞</span>
          </h1>
          <p class="text-slate-400 text-sm sm:text-base">–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, API –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –¢—ë–º–Ω–∞—è —Ç–µ–º–∞, –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–¥–∞.</p>
        </div>
        <div class="flex gap-2 text-xs text-slate-400">
          <span class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700">Tailwind v4</span>
          <span class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700">highlight.js</span>
          <span class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700">Dark UI</span>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Quick Reference Table -->
    <section id="quick-ref" class="section-card p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4 text-sky-400">üìã –ë—ã—Å—Ç—Ä—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="text-slate-300 border-b border-slate-700/60">
              <th class="py-2 pr-4">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th class="py-2">–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/–æ–±—ä–µ–∫—Ç—ã</th>
            </tr>
          </thead>
          <tbody class="align-top">
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">ORM –∏ QuerySet</td>
              <td class="py-3 text-slate-300">Q, F, Count, Sum, Avg, Min, Max, Case/When, Exists, Subquery, Window, select_related, prefetch_related, filter, exclude, get, all, values, values_list, annotate, aggregate, order_by, distinct, update, delete</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–§–æ—Ä–º—ã</td>
              <td class="py-3 text-slate-300">Form, ModelForm, formset_factory, inlineformset_factory, –ø–æ–ª—è, –≤–∏–¥–∂–µ—Ç—ã, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</td>
              <td class="py-3 text-slate-300">authenticate, login, logout, get_user_model, Permission, Group, has_perm, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">HTTP</td>
              <td class="py-3 text-slate-300">HttpResponse, JsonResponse, FileResponse, StreamingHttpResponse, redirect, reverse</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–®–∞–±–ª–æ–Ω—ã</td>
              <td class="py-3 text-slate-300">render, render_to_string, —Ç–µ–≥–∏: if, for, block, extends, include, url, static, csrf_token; —Ñ–∏–ª—å—Ç—Ä—ã: upper, lower, date, truncatewords</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">URL</td>
              <td class="py-3 text-slate-300">path, re_path, include, reverse, get_absolute_url, converters</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–°–µ—Å—Å–∏–∏</td>
              <td class="py-3 text-slate-300">request.session set/get/pop/flush/cycle_key</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">Cookies</td>
              <td class="py-3 text-slate-300">set_cookie, delete_cookie, request.COOKIES</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–°–∏–≥–Ω–∞–ª—ã</td>
              <td class="py-3 text-slate-300">pre_save, post_save, pre_delete, post_delete, m2m_changed, @receiver</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–ö—ç—à</td>
              <td class="py-3 text-slate-300">cache.get/set/delete/clear, @cache_page, @vary_on_cookie</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</td>
              <td class="py-3 text-slate-300">logging.getLogger, logger.debug/info/warning/error</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–§–∞–π–ª—ã</td>
              <td class="py-3 text-slate-300">request.FILES, default_storage, FileSystemStorage, –ø—É—Ç–∏</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">JSON</td>
              <td class="py-3 text-slate-300">json.dumps/loads, JSONField, JsonResponse</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–ú–∏–≥—Ä–∞—Ü–∏–∏</td>
              <td class="py-3 text-slate-300">CreateModel, AddField, RemoveField, AlterField, RenameModel, RunPython</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">Admin</td>
              <td class="py-3 text-slate-300">list_display, list_filter, search_fields, readonly_fields, inlines, actions</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">i18n</td>
              <td class="py-3 text-slate-300">gettext/gettext_lazy, activate, get_language, LANGUAGE_CODE, LANGUAGES</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</td>
              <td class="py-3 text-slate-300">timezone.now, DateField, DateTimeField, auto_now, auto_now_add</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</td>
              <td class="py-3 text-slate-300">TestCase, Client, RequestFactory, fixtures, @override_settings</td>
            </tr>
            <tr>
              <td class="py-3 pr-4 font-semibold">–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã</td>
              <td class="py-3 text-slate-300">serialize/deserialize, dumpdata/loaddata, slugify, mark_safe, hashlib, secrets, apps, ContentType, import_string</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <div class="flex gap-6">
      <!-- TOC -->
      <aside id="toc" class="w-[280px] shrink-0 section-card p-4 h-[calc(100vh-8rem)] sticky top-28 hidden lg:block">
        <h3 class="text-lg font-semibold mb-3 text-purple-300">–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ</h3>
        <nav class="text-sm space-y-2 overflow-y-auto h-[calc(100%-2rem)]">
          <a class="block text-slate-400 hover:text-sky-400" href="#orm">1. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#forms">2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#auth">3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#http">4. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTP</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#templates">5. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#urls">6. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#sessions">7. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#cookies">8. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Cookies</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#signals">9. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#cache">10. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#logging">11. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#files">12. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#json">13. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#migrations">14. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#admin">15. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Admin –ø–∞–Ω–µ–ª—å—é</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#i18n">16. –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (i18n)</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#time">17. –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#testing">18. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#serialization">19. –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#utils">20. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã</a>
        </nav>
      </aside>

      <!-- Main content -->
      <main class="flex-1 space-y-8">
        <!-- ORM & QuerySet -->
        <section id="orm" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">1. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏ (ORM –∏ QuerySet)</h2>
          <p class="text-slate-300 mb-4">–ö–ª—é—á–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏: Q, F, –∞–≥—Ä–µ–≥–∞—Ç—ã (Count, Sum, Avg, Min, Max), Case/When, Exists, Subquery/OuterRef, Window, select_related, prefetch_related, –∞ —Ç–∞–∫–∂–µ –º–µ—Ç–æ–¥—ã QuerySet: filter, exclude, get, all, values, values_list, annotate, aggregate, order_by, distinct, update, delete, create.</p>

          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ú–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># app/models.py
from django.db import models
from django.db.models import Q, F, Count, Sum, Avg, Min, Max, Case, When, IntegerField, Subquery, OuterRef, Exists, Window
from django.db.models.functions import RowNumber

class Author(models.Model):
    name = models.CharField(max_length=120)
    is_active = models.BooleanField(default=True)

class Category(models.Model):
    name = models.CharField(max_length=60)

class Book(models.Model):
    title = models.CharField(max_length=200)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True, blank=True)
    price = models.DecimalField(max_digits=10, decimal_places=2)
    stock = models.IntegerField(default=0)
    published_at = models.DateField(null=True, blank=True)

class Order(models.Model):
    created_at = models.DateTimeField(auto_now_add=True)

class OrderItem(models.Model):
    order = models.ForeignKey(Order, on_delete=models.CASCADE, related_name='items')
    book = models.ForeignKey(Book, on_delete=models.CASCADE)
    qty = models.PositiveIntegerField()
    price = models.DecimalField(max_digits=10, decimal_places=2)
</code></pre>
            </div>
          </div>

          <!-- Q -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Q ‚Äî —Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (AND/OR/NOT)</h3>
            <p class="text-slate-300 mb-3">–û–±—ä–µ–¥–∏–Ω—è–µ—Ç —É—Å–ª–æ–≤–∏—è —Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ | (OR), & (AND), ~ (NOT). –£–¥–æ–±–Ω–æ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Q

# –ù–∞–π—Ç–∏ –∫–Ω–∏–≥–∏ —Å–æ —Å–ª–æ–≤–æ–º "Django" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ò–õ–ò –∫–Ω–∏–≥–∏ —Å–æ —Å–∫–ª–∞–¥–æ–º &gt; 0
qs = Book.objects.filter(Q(title__icontains='django') | Q(stock__gt=0))

# –ò—Å–∫–ª—é—á–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤
qs = Book.objects.filter(~Q(author__is_active=False))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–∏—Å–∫–æ–≤—ã–µ —Ñ–æ—Ä–º—ã, —Å–ª–æ–∂–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –º–Ω–æ–≥–∏–º –ø–æ–ª—è–º, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π.</div>
          </div>

          <!-- F -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">F ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—è –º–æ–¥–µ–ª–∏ (–æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î)</h3>
            <p class="text-slate-300 mb-3">–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç—å.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import F

# –£–≤–µ–ª–∏—á–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ –Ω–∞ 5 –¥–ª—è –≤—Å–µ—Ö –∫–Ω–∏–≥ –∞–≤—Ç–æ—Ä–∞
Book.objects.filter(author__name='Tom').update(stock=F('stock') + 5)

# –í—ã–±—Ä–∞—Ç—å –∫–Ω–∏–≥–∏, –≥–¥–µ —Ü–µ–Ω–∞ &gt;= –∫–æ–ª-–≤–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
qs = Book.objects.filter(price__gte=F('stock'))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã/–¥–µ–∫—Ä–µ–º–µ–Ω—Ç—ã, –º–∞—Å—Å–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–º—è—Ç—å.</div>
          </div>

          <!-- Aggregates -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ê–≥—Ä–µ–≥–∞—Ç—ã: Count, Sum, Avg, Min, Max</h3>
            <p class="text-slate-300 mb-3">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ annotate –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∫ –∫–∞–∂–¥–æ–º—É –æ–±—ä–µ–∫—Ç—É –∏ aggregate –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –≤—Å–µ–º—É –Ω–∞–±–æ—Ä—É.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Count, Sum, Avg, Min, Max

# –ö–æ–ª-–≤–æ –∫–Ω–∏–≥ —É –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
authors = Author.objects.annotate(books_count=Count('book'))

# –ò—Ç–æ–≥–æ –ø—Ä–æ–¥–∞–∂ –ø–æ –∑–∞–∫–∞–∑—É
orders = Order.objects.annotate(total=Sum(F('items__qty') * F('items__price')))

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –∫–Ω–∏–≥–∞–º
stats = Book.objects.aggregate(
    total=Count('id'),
    avg_price=Avg('price'),
    min_price=Min('price'),
    max_price=Max('price'),
)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –æ—Ç—á—ë—Ç—ã, —Å–ø–∏—Å–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏, KPI, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º.</div>
          </div>

          <!-- Case/When -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Case / When ‚Äî —É—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î</h3>
            <p class="text-slate-300 mb-3">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è –∏ —Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ/—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ –Ω–∏–º.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Case, When, IntegerField

qs = Book.objects.annotate(
    availability=Case(
        When(stock__lte=0, then=0),
        When(stock__lt=10, then=1),
        default=2,
        output_field=IntegerField(),
    )
).order_by('-availability')
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –ø—Ä–∞–≤–∏–ª–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</div>
          </div>

          <!-- Exists -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Exists ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π</h3>
            <p class="text-slate-300 mb-3">–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º EXISTS –≤–º–µ—Å—Ç–æ JOIN-–æ–≤/COUNT-–æ–≤.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Exists, OuterRef

has_items = OrderItem.objects.filter(order=OuterRef('pk'))
orders = Order.objects.annotate(has_items=Exists(has_items)).filter(has_items=True)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ñ–∏–ª—å—Ç—Ä ¬´–µ—Å—Ç—å –ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã¬ª, ¬´–µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏¬ª.</div>
          </div>

          <!-- Subquery -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Subquery / OuterRef ‚Äî –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã</h3>
            <p class="text-slate-300 mb-3">–ü–æ–¥—Å—Ç–∞–≤–ª—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Subquery, OuterRef

last_price = (
    OrderItem.objects.filter(book=OuterRef('pk'))
    .order_by('-id')
    .values('price')[:1]
)
qs = Book.objects.annotate(last_sold_price=Subquery(last_price))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ/–ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã.</div>
          </div>

          <!-- Window -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Window ‚Äî –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
            <p class="text-slate-300 mb-3">–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –∏–ª–∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Window
from django.db.models.functions import RowNumber

ranked = Book.objects.annotate(
    row_number=Window(expression=RowNumber(), order_by=F('price').desc())
)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º, —Å–∫–æ–ª—å–∑—è—â–∏–µ –∞–≥—Ä–µ–≥–∞—Ç—ã (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –°–£–ë–î).</div>
          </div>

          <!-- select_related / prefetch_related -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">select_related / prefetch_related ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è N+1</h3>
            <p class="text-slate-300 mb-3">select_related –¥–µ–ª–∞–µ—Ç JOIN –¥–ª—è ForeignKey/OneToOne, prefetch_related –¥–µ–ª–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞ Python-—Å—Ç–æ—Ä–æ–Ω–µ (–≤ —Ç.—á. ManyToMany –∏ –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–≤—è–∑–∏).</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É/–º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É
books = Book.objects.select_related('author', 'category').all()

# –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º/–æ–±—Ä–∞—Ç–Ω—ã–µ
from django.db.models import Prefetch
items_prefetch = Prefetch('items', queryset=OrderItem.objects.select_related('book'))
orders = Order.objects.prefetch_related(items_prefetch)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Å–ø–∏—Å–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π; —É—Å—Ç—Ä–∞–Ω—è–µ—Ç N+1 –∑–∞–ø—Ä–æ—Å–æ–≤.</div>
          </div>

          <!-- QuerySet API essentials -->
          <div class="mb-2">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ú–µ—Ç–æ–¥—ã QuerySet: filter, exclude, get, all, values, values_list –∏ –¥—Ä.</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –ë–∞–∑–æ–≤—ã–µ
Book.objects.all()
Book.objects.filter(price__gte=100)
Book.objects.exclude(stock__lte=0)
Book.objects.get(pk=1)

# –ü–æ–ª—è —Å–ª–æ–≤–∞—Ä—è/—Å–ø–∏—Å–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
Book.objects.values('id', 'title')
Book.objects.values_list('id', flat=True)

# –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏/–∞–≥—Ä–µ–≥–∞—Ü–∏–∏
Book.objects.annotate(num_items=Count('orderitem'))
Book.objects.aggregate(total=Count('id'))

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
Book.objects.order_by('-price', 'title').distinct('title')  # distinct(fields) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ –≤—Å–µ–º–∏ –ë–î

# –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
Book.objects.filter(stock=0).update(stock=5)
Book.objects.filter(price__lt=10).delete()

# –°–æ–∑–¥–∞–Ω–∏–µ
Book.objects.create(title='New', author=Author.objects.first(), price=10, stock=3)
Book.objects.bulk_create([
    Book(title='A', author=Author.objects.first(), price=5, stock=2),
    Book(title='B', author=Author.objects.first(), price=8, stock=4),
])
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏, –≤—ã–±–æ—Ä–∫–∏, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è API –∏ –∞–¥–º–∏–Ω–∫–∏, –æ—Ç—á—ë—Ç—ã.</div>
          </div>
        </section>


          <!-- QuerySet Advanced Methods -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã QuerySet</h3>
            <p class="text-slate-300 mb-3">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏: get_or_create, update_or_create, bulk_update, first, last, earliest, latest, only, defer, iterator, in_bulk, union, intersection, difference.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
book, created = Book.objects.get_or_create(
    title='Django Guide',
    defaults={'price': 29.99, 'stock': 10, 'author': author}
)

book, created = Book.objects.update_or_create(
    title='Django Guide',
    defaults={'price': 34.99, 'stock': 15}
)

# –ü–µ—Ä–≤—ã–π/–ø–æ—Å–ª–µ–¥–Ω–∏–π/—Ä–∞–Ω–Ω–∏–π/–ø–æ–∑–¥–Ω–∏–π
first_book = Book.objects.first()
last_book = Book.objects.last()
oldest = Book.objects.earliest('published_at')
newest = Book.objects.latest('published_at')

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π (—É–º–µ–Ω—å—à–∞–µ—Ç –ø–∞–º—è—Ç—å)
books = Book.objects.only('title', 'price')
books = Book.objects.defer('description')

# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤
for book in Book.objects.iterator(chunk_size=1000):
    process(book)

# –ü–æ–ª—É—á–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å {id: –æ–±—ä–µ–∫—Ç}
books_dict = Book.objects.in_bulk([1, 2, 3])

# –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
books = list(Book.objects.filter(price__lt=20))
for book in books:
    book.price += 5
Book.objects.bulk_update(books, ['price'])

# –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–∞–º–∏ QuerySet
cheap = Book.objects.filter(price__lt=15)
expensive = Book.objects.filter(price__gt=100)

all_interesting = cheap.union(expensive)         # OR
both = cheap.intersection(expensive)             # AND
only_cheap = cheap.difference(expensive)         # –†–∞–∑–Ω–æ—Å—Ç—å

# –ü—É—Å—Ç–æ–π QuerySet –∏ —Å—ã—Ä–æ–π SQL
empty = Book.objects.none()
books = Book.objects.raw('SELECT * FROM app_book WHERE price > %s', [10])
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: get_or_create/update_or_create –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, only/defer –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏, iterator –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∑–∞–ø–∏—Å–µ–π, bulk_update –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, union/intersection/difference –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫.</div>
          </div>

        <!-- Forms -->
        <section id="forms" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">–†–∞–±–æ—Ç–∞ —Å Form/ModelForm, –Ω–∞–±–æ—Ä–∞–º–∏ —Ñ–æ—Ä–º, –ø–æ–ª—è–º–∏, –≤–∏–¥–∂–µ—Ç–∞–º–∏ –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏.</p>

          <!-- Form / ModelForm -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">Form / ModelForm ‚Äî –±–∞–∑–æ–≤—ã–µ —Ñ–æ—Ä–º—ã</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># forms.py
from django import forms
from .models import Book

class ContactForm(forms.Form):
    name = forms.CharField(max_length=60)
    email = forms.EmailField()
    message = forms.CharField(widget=forms.Textarea)

class BookForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'author', 'price', 'stock', 'category']
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># views.py
from django.shortcuts import render, redirect
from .forms import ContactForm, BookForm

def contact_view(request):
    if request.method == 'POST':
        form = ContactForm(request.POST)
        if form.is_valid():
            # –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å form.cleaned_data
            return redirect('thanks')
    else:
        form = ContactForm()
    return render(request, 'contact.html', {'form': form})


def book_create(request):
    if request.method == 'POST':
        form = BookForm(request.POST)
        if form.is_valid():
            form.save()
            return redirect('books-list')
    else:
        form = BookForm()
    return render(request, 'book_form.html', {'form': form})
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: HTML-—Ñ–æ—Ä–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.</div>
          </div>

          <!-- Formsets -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">formset_factory / inlineformset_factory ‚Äî –Ω–∞–±–æ—Ä—ã —Ñ–æ—Ä–º</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># forms.py
from django.forms import formset_factory, inlineformset_factory
from .models import Order, OrderItem
from django import forms

class OrderItemForm(forms.ModelForm):
    class Meta:
        model = OrderItem
        fields = ['book', 'qty', 'price']

OrderItemFormSet = inlineformset_factory(
    Order, OrderItem, form=OrderItemForm, extra=1, can_delete=True
)
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mt-3">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># views.py
from django.shortcuts import render, redirect, get_object_or_404
from .forms import OrderItemFormSet
from .models import Order

def order_edit(request, pk):
    order = get_object_or_404(Order, pk=pk)
    formset = OrderItemFormSet(request.POST or None, instance=order)
    if request.method == 'POST' and formset.is_valid():
        formset.save()
        return redirect('orders')
    return render(request, 'order_edit.html', {'formset': formset})
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ (–Ω–∞–ø—Ä., —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞ –∫ –∑–∞–∫–∞–∑—É).</div>
          </div>

          <!-- Fields / Widgets / Validators -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">–ü–æ–ª—è —Ñ–æ—Ä–º, –≤–∏–¥–∂–µ—Ç—ã, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã</h3>
            <p class="text-slate-300 mb-3">–ß–∞—Å—Ç—ã–µ —Ç–∏–ø—ã –ø–æ–ª–µ–π: CharField, EmailField, IntegerField, FloatField, DecimalField, BooleanField, DateField, DateTimeField, TimeField, URLField, ChoiceField, MultipleChoiceField, ModelChoiceField, ModelMultipleChoiceField, FileField, ImageField, TypedChoiceField, RegexField, SlugField, UUIDField, JSONField.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># forms.py
from django import forms
from django.core.validators import MinValueValidator, MaxValueValidator, RegexValidator
from .models import Book

class DemoForm(forms.Form):
    name = forms.CharField(max_length=50, widget=forms.TextInput(attrs={'class': 'input'}))
    email = forms.EmailField()
    age = forms.IntegerField(validators=[MinValueValidator(0), MaxValueValidator(120)])
    site = forms.URLField(required=False)
    agree = forms.BooleanField(required=False)
    when = forms.DateTimeField(widget=forms.DateTimeInput(attrs={'type': 'datetime-local'}))
    color = forms.ChoiceField(choices=[('r','Red'), ('g','Green')], widget=forms.RadioSelect)
    tags = forms.MultipleChoiceField(choices=[('a','A'), ('b','B')], widget=forms.CheckboxSelectMultiple)
    price = forms.DecimalField(max_digits=8, decimal_places=2)
    slug = forms.SlugField()
    code = forms.RegexField(regex=r'^[A-Z]{3}-\d{3}$', validators=[RegexValidator(r'^[A-Z]{3}-\d{3}$')])
    json = forms.JSONField(required=False)

class BookWidgetForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'author', 'price', 'stock', 'category']
        widgets = {
            'title': forms.TextInput(attrs={'placeholder': '–ù–∞–∑–≤–∞–Ω–∏–µ'}),
            'price': forms.NumberInput(attrs={'min': '0', 'step': '0.01'}),
            'category': forms.Select(attrs={'class': 'select'}),
        }
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: UX –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤, —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ä–∞–±–æ—Ç–∞ —Å JSON –≤ —Ñ–æ—Ä–º–∞—Ö.</div>
          </div>
        </section>


          <!-- Form Custom Validation -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">–ö–∞—Å—Ç–æ–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º</h3>
            <p class="text-slate-300 mb-3">–ú–µ—Ç–æ–¥—ã clean_FIELD() –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏ clean() –¥–ª—è –∫—Ä–æ—Å—Å-–ø–æ–ª–µ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django import forms
from django.core.exceptions import ValidationError

class RegistrationForm(forms.Form):
    username = forms.CharField(max_length=30)
    email = forms.EmailField()
    password = forms.CharField(widget=forms.PasswordInput)
    password_confirm = forms.CharField(widget=forms.PasswordInput)
    age = forms.IntegerField()
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è
    def clean_username(self):
        username = self.cleaned_data['username']
        if User.objects.filter(username=username).exists():
            raise ValidationError('–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ')
        if len(username) < 3:
            raise ValidationError('–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞')
        return username.lower()
    
    def clean_email(self):
        email = self.cleaned_data['email']
        if not email.endswith('@example.com'):
            raise ValidationError('–¢–æ–ª—å–∫–æ @example.com –∞–¥—Ä–µ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã')
        return email
    
    def clean_age(self):
        age = self.cleaned_data['age']
        if age < 18:
            raise ValidationError('–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 18+')
        return age
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Ü–µ–ª–∏–∫–æ–º (–∫—Ä–æ—Å—Å-–ø–æ–ª–µ–≤–∞—è)
    def clean(self):
        cleaned_data = super().clean()
        password = cleaned_data.get('password')
        password_confirm = cleaned_data.get('password_confirm')
        
        if password and password_confirm:
            if password != password_confirm:
                raise ValidationError({
                    'password_confirm': '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'
                })
            if len(password) < 8:
                raise ValidationError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤')
        
        return cleaned_data
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: clean_FIELD() –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π, clean() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –ø–æ–ª—è–º–∏.</div>
          </div>

        <!-- Auth -->
        <section id="auth" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">3. –§—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
          <p class="text-slate-300 mb-4">–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: authenticate(), login(), logout(), get_user_model(); –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–∞–≤–∞; –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># views.py
from django.contrib.auth import authenticate, login, logout, get_user_model
from django.contrib.auth.decorators import login_required, permission_required, user_passes_test
from django.shortcuts import render, redirect

User = get_user_model()

def login_view(request):
    if request.method == 'POST':
        user = authenticate(request, username=request.POST['username'], password=request.POST['password'])
        if user:
            login(request, user)
            return redirect('home')
    return render(request, 'login.html')

@login_required
def secret_view(request):
    return render(request, 'secret.html')

@permission_required('app.view_book', raise_exception=True)
def staff_view(request):
    ...

@user_passes_test(lambda u: u.is_superuser)
def only_superusers(request):
    ...


def logout_view(request):
    logout(request)
    return redirect('login')
</code></pre>
          </div>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># –†–∞–±–æ—Ç–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –∏ –≥—Ä—É–ø–ø–∞–º–∏
from django.contrib.auth.models import Permission, Group

edit_perm = Permission.objects.get(codename='change_book')
editors, _ = Group.objects.get_or_create(name='Editors')
editors.permissions.add(edit_perm)

user = User.objects.first()
user.groups.add(editors)

if user.has_perm('app.change_book'):
    print('–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å')
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π login/logout, –¥–æ—Å—Ç—É–ø –ø–æ –ø—Ä–∞–≤–∞–º/—Ä–æ–ª—è–º, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º.</div>
        </section>


          <!-- Auth Mixins for CBV -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ú–∏–∫—Å–∏–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è CBV</h3>
            <p class="text-slate-300 mb-3">–î–ª—è Class-Based Views –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–∫—Å–∏–Ω—ã: LoginRequiredMixin, PermissionRequiredMixin, UserPassesTestMixin.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.contrib.auth.mixins import LoginRequiredMixin, PermissionRequiredMixin, UserPassesTestMixin
from django.views.generic import ListView, UpdateView
from django.contrib.auth import update_session_auth_hash
from .models import Book

class BookListView(LoginRequiredMixin, ListView):
    model = Book
    login_url = '/login/'  # –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –µ—Å–ª–∏ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω

class BookUpdateView(PermissionRequiredMixin, UpdateView):
    model = Book
    fields = ['title', 'price']
    permission_required = 'app.change_book'
    raise_exception = True  # 403 –≤–º–µ—Å—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

class AdminBookView(UserPassesTestMixin, ListView):
    model = Book
    def test_func(self):
        return self.request.user.is_superuser

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –±–µ–∑ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–Ω–∏—è
def change_password(request):
    if request.method == 'POST':
        user = request.user
        user.set_password(request.POST['new_password'])
        user.save()
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
        update_session_auth_hash(request, user)
        return redirect('profile')
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –º–∏–∫—Å–∏–Ω—ã –¥–ª—è CBV –≤–º–µ—Å—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤, update_session_auth_hash –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</div>
          </div>


          <!-- Sessions Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏</h3>
            <p class="text-slate-300 mb-3">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã: set_test_cookie, test_cookie_worked, delete_test_cookie, session_key, modified.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ cookies
def step1(request):
    request.session.set_test_cookie()
    return render(request, 'step1.html')

def step2(request):
    if request.session.test_cookie_worked():
        request.session.delete_test_cookie()
        # Cookies —Ä–∞–±–æ—Ç–∞—é—Ç
    else:
        # Cookies –æ—Ç–∫–ª—é—á–µ–Ω—ã
        return HttpResponse('–í–∫–ª—é—á–∏—Ç–µ cookies')
    return render(request, 'step2.html')

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏
def session_info(request):
    return JsonResponse({
        'session_key': request.session.session_key,
        'modified': request.session.modified,  # –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–∏ —Å–µ—Å—Å–∏—è
        'age': request.session.get_expiry_age(),
        'expires_at': request.session.get_expiry_date(),
    })

# –†—É—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∫–æ–≥–¥–∞ modified=False)
def update_nested(request):
    request.session['cart']['item1']['quantity'] = 5
    request.session.modified = True  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
    request.session.save()

# –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–µ—Å—Å–∏–π (management command)
# python manage.py clearsessions
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: test_cookie –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ cookies, modified=True –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, session_key –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.</div>
          </div>

        <!-- HTTP -->
        <section id="http" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">4. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTP</h2>
          <p class="text-slate-300 mb-4">HttpResponse, JsonResponse, FileResponse, StreamingHttpResponse, –º–µ—Ç–æ–¥—ã request, redirect(), reverse().</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.http import HttpResponse, JsonResponse, FileResponse, StreamingHttpResponse
from django.shortcuts import redirect
from django.urls import reverse

# –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
def hello(request):
    if request.method == 'GET':
        return HttpResponse('Hello, world!', content_type='text/plain')

# JSON
def api_data(request):
    data = {'ok': True, 'user': request.user.username if request.user.is_authenticated else None}
    return JsonResponse(data, status=200)

# –§–∞–π–ª –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
def download_manual(request):
    return FileResponse(open('/path/to/manual.pdf', 'rb'), as_attachment=True, filename='manual.pdf')

# –°—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
def stream_numbers(request):
    def gen():
        for i in range(5):
            yield f"{i}\n"
    return StreamingHttpResponse(gen(), content_type='text/plain')

# redirect + reverse
def go_home(request):
    return redirect(reverse('home'))
</code></pre>
            </div>
            <div class="section-card p-4">
              <h3 class="text-lg font-semibold text-amber-300 mb-2">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
              <ul class="list-disc list-inside text-slate-300 text-sm space-y-1">
                <li>HttpResponse –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö/HTML –æ—Ç–≤–µ—Ç–æ–≤</li>
                <li>JsonResponse –¥–ª—è API (safe=False –¥–ª—è —Å–ø–∏—Å–∫–æ–≤)</li>
                <li>FileResponse –¥–ª—è –æ—Ç–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ</li>
                <li>StreamingHttpResponse –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–ª–∏ ¬´–∂–∏–≤—ã—Ö¬ª –ø–æ—Ç–æ–∫–æ–≤</li>
                <li>redirect/reverse –¥–ª—è –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö URL –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</li>
              </ul>
            </div>
          </div>
        </section>


          <!-- HTTP Response Variants and Shortcuts -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">HTTP –æ—Ç–≤–µ—Ç—ã –∏ shortcuts</h3>
            <p class="text-slate-300 mb-3">–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HTTP –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ shortcuts –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–¥–∞.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.http import (
    HttpResponseRedirect, HttpResponsePermanentRedirect,
    HttpResponseNotFound, HttpResponseBadRequest,
    HttpResponseForbidden, HttpResponseServerError
)
from django.shortcuts import get_object_or_404, get_list_or_404

# –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã
def custom_404(request):
    return HttpResponseNotFound('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞')

def custom_400(request):
    return HttpResponseBadRequest('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å')

def custom_403(request):
    return HttpResponseForbidden('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω')

def custom_500(request):
    return HttpResponseServerError('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞')

# Shortcuts - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π 404
def book_detail(request, pk):
    book = get_object_or_404(Book, pk=pk)
    return render(request, 'book.html', {'book': book})

def books_by_author(request, author_id):
    books = get_list_or_404(Book, author_id=author_id)
    return render(request, 'books.html', {'books': books})

# –ê—Ç—Ä–∏–±—É—Ç—ã request
def request_info(request):
    return JsonResponse({
        'method': request.method,
        'path': request.path,
        'full_path': request.get_full_path(),
        'host': request.get_host(),
        'is_secure': request.is_secure(),
        'user_agent': request.META.get('HTTP_USER_AGENT', ''),
        'content_type': request.content_type,
    })
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: get_object_or_404/get_list_or_404 –≤–º–µ—Å—Ç–æ try/except –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –∫–æ–¥–∞, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HttpResponse* –¥–ª—è —è–≤–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤.</div>
          </div>


          <!-- Signals Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
            <p class="text-slate-300 mb-3">request_started, request_finished, pre_migrate, post_migrate, —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –°–∏–≥–Ω–∞–ª—ã –∑–∞–ø—Ä–æ—Å–∞
from django.core.signals import request_started, request_finished
from django.dispatch import receiver

@receiver(request_started)
def on_request_start(sender, environ, **kwargs):
    print('–ó–∞–ø—Ä–æ—Å –Ω–∞—á–∞—Ç')

@receiver(request_finished)
def on_request_finish(sender, **kwargs):
    print('–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à—ë–Ω')

# –°–∏–≥–Ω–∞–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
from django.db.models.signals import pre_migrate, post_migrate

@receiver(post_migrate)
def create_default_data(sender, **kwargs):
    if sender.name == 'app':
        # –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π
        Category.objects.get_or_create(name='Default')

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
from django.dispatch import Signal

order_placed = Signal()  # providing_args deprecated –≤ Django 3.1+

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞
def place_order(request, order):
    # ... –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
    order_placed.send(sender=order.__class__, order=order, user=request.user)

# –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª
@receiver(order_placed)
def send_order_email(sender, order, user, **kwargs):
    send_email(user.email, f'–ó–∞–∫–∞–∑ #{order.id} –æ—Ñ–æ—Ä–º–ª–µ–Ω')

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤/–º–∏–≥—Ä–∞—Ü–∏–π)
from django.db.models.signals import post_save

@receiver(post_save, sender=Book)
def book_saved(sender, instance, **kwargs):
    print('Book saved')

# –í –∫–æ–¥–µ:
from django.db.models.signals import post_save

post_save.disconnect(book_saved, sender=Book)
# ... –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ —Å–∏–≥–Ω–∞–ª–∞
post_save.connect(book_saved, sender=Book)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: request_started/finished –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, post_migrate –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è —Å–ª–∞–±–æ—Å–≤—è–∑–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.</div>
          </div>

        <!-- Templates -->
        <section id="templates" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">5. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">render(), render_to_string(), –æ—Å–Ω–æ–≤–Ω—ã–µ template tags –∏ —Ñ–∏–ª—å—Ç—Ä—ã.</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># views.py
from django.shortcuts import render
from django.template.loader import render_to_string

def page(request):
    return render(request, 'page.html', {'title': 'Welcome'})

html = render_to_string('email.html', {'username': 'alice'})
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-xml">&lt;!-- template: base.html --&gt;
{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>{% block title %}Site{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/site.css' %}">
  </head>
  <body>
    {% block content %}{% endblock %}
  </body>
</html>

&lt;!-- template: page.html --&gt;
{% extends 'base.html' %}
{% block title %}{{ title|default:'Title' }}{% endblock %}
{% block content %}
  {% if user.is_authenticated %}
    <p>Hello, {{ user.username|upper }}!</p>
  {% else %}
    <p>Please log in.</p>
  {% endif %}
  <ul>
    {% for b in books %}
      <li>{{ b.title }} ‚Äî {{ b.price|floatformat:2 }}</li>
    {% empty %}
      <li>–ù–µ—Ç –∫–Ω–∏–≥</li>
    {% endfor %}
  </ul>
  {% include 'partials/pager.html' %}
  <form method="post">{% csrf_token %} ... </form>
{% endblock %}
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ HTML, email-—à–∞–±–ª–æ–Ω—ã, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–ª–æ–∫–∏, —Å—Ç–∞—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ {% static %}.</div>
        </section>


          <!-- Template Tags and Filters -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤</h3>
            <p class="text-slate-300 mb-3">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏: with, now, comment, verbatim, autoescape, regroup, firstof. –§–∏–ª—å—Ç—Ä—ã: length, join, slice, timesince, timeuntil, pluralize, –∏ –¥—Ä—É–≥–∏–µ.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-xml">&lt;!-- –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è --&gt;
{% with total=items|length %}
  –£ –≤–∞—Å {{ total }} —Ç–æ–≤–∞—Ä–æ–≤
{% endwith %}

&lt;!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π URL --&gt;
<a href="{% url 'book-detail' pk=book.id %}">–î–µ—Ç–∞–ª–∏</a>

&lt;!-- –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è --&gt;
{% now "Y-m-d H:i" %}

&lt;!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π --&gt;
{% comment %}–ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è{% endcomment %}

&lt;!-- Verbatim - Django –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç --&gt;
{% verbatim %}{{ js_template }}{% endverbatim %}

&lt;!-- –ê–≤—Ç–æ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ --&gt;
{% autoescape off %}{{ html_content }}{% endautoescape %}

&lt;!-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö --&gt;
{% regroup cities by country as country_list %}
{% for country in country_list %}
  <h3>{{ country.grouper }}</h3>
  {% for city in country.list %}
    <li>{{ city.name }}</li>
  {% endfor %}
{% endfor %}

&lt;!-- –ü–µ—Ä–≤–æ–µ –Ω–µ-–ø—É—Å—Ç–æ–µ --&gt;
{% firstof var1 var2 "default" %}

&lt;!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã --&gt;
{{ text|upper }}  {{ text|lower }}  {{ text|title }}
{{ text|truncatewords:10 }}  {{ text|truncatechars:50 }}
{{ text|slugify }}  {{ html|striptags }}  {{ html|safe }}
{{ text|linebreaks }}
{{ number|add:5 }}  {{ price|floatformat:2 }}
{{ items|length }}  {{ items|first }}  {{ items|last }}
{{ items|join:", " }}  {{ items|slice:":5" }}
{{ date|date:"Y-m-d" }}  {{ date|timesince }}  {{ date|timeuntil }}
{{ value|default:"–Ω–µ—Ç" }}  {{ bool|yesno:"–¥–∞,–Ω–µ—Ç" }}
{{ url|urlencode }}  {{ text|urlize }}
{{ count|pluralize }}  {{ count|pluralize:"ies" }}
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: with –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, now –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, verbatim –¥–ª—è JS —à–∞–±–ª–æ–Ω–æ–≤, regroup –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –ª–∏—à–Ω–µ–π –ª–æ–≥–∏–∫–∏ –≤–æ –≤—å—é—Ö–∞—Ö.</div>
          </div>


          <!-- Logging Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <p class="text-slate-300 mb-3">–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ LOGGING –≤ settings.py —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># settings.py
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {message}',
            'style': '{',
        },
        'simple': {
            'format': '{levelname} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
            'formatter': 'verbose',
        },
        'file': {
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': 'logs/django.log',
            'maxBytes': 1024 * 1024 * 10,  # 10MB
            'backupCount': 5,
            'formatter': 'verbose',
        },
    },
    'loggers': {
        'django': {
            'handlers': ['console', 'file'],
            'level': 'INFO',
        },
        'app': {
            'handlers': ['console', 'file'],
            'level': 'DEBUG',
            'propagate': False,
        },
    },
}

# views.py
import logging
logger = logging.getLogger('app')

def my_view(request):
    logger.debug('Debug message')
    logger.info('Info message')
    logger.warning('Warning message')
    logger.error('Error message')
    logger.critical('Critical message')
    
    try:
        risky_operation()
    except Exception:
        logger.exception('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞')  # –õ–æ–≥–∏—Ä—É–µ—Ç —Å traceback
    
    return HttpResponse('OK')
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: DEBUG –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, INFO –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, WARNING –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, ERROR –¥–ª—è –æ—à–∏–±–æ–∫, CRITICAL –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤. exception() –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ traceback.</div>
          </div>

        <!-- URLs -->
        <section id="urls" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">6. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL</h2>
          <p class="text-slate-300 mb-4">path(), re_path(), include(), reverse(), get_absolute_url(), –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># urls.py
from django.urls import path, re_path, include
from . import views

urlpatterns = [
    path('', views.home, name='home'),
    path('book/<int:pk>/', views.book_detail, name='book-detail'),
    re_path(r'^search/(?P&lt;q&gt;.+)/$', views.search, name='search'),
    path('api/', include('app.api_urls')),
]

# models.py ‚Äî get_absolute_url
from django.urls import reverse
class Book(models.Model):
    ...
    def get_absolute_url(self):
        return reverse('book-detail', args=[self.pk])
</code></pre>
          </div>
          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># –ü—Ä–∏–º–µ—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–≤
# converters.py
class YearConverter:
    regex = '[0-9]{4}'
    def to_python(self, value): return int(value)
    def to_url(self, value): return f'{value:04d}'

# urls.py
from django.urls import register_converter
from .converters import YearConverter
register_converter(YearConverter, 'yyyy')
urlpatterns += [
    path('archive/<yyyy:year>/', views.archive, name='archive')
]
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã, reverse –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –∫–æ–¥–µ –∏ —à–∞–±–ª–æ–Ω–∞—Ö, include –¥–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.</div>
        </section>


          <!-- URL Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">reverse_lazy –∏ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã</h3>
            <p class="text-slate-300 mb-3">reverse_lazy –¥–ª—è CBV, namespace –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã (int, str, slug, uuid, path).</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># urls.py
from django.urls import path, include

app_name = 'books'  # namespace

urlpatterns = [
    path('book/<int:pk>/', views.detail, name='detail'),
    path('book/<slug:slug>/', views.by_slug, name='by-slug'),
    path('author/<uuid:id>/', views.author, name='author'),
    path('files/<path:filepath>/', views.file, name='file'),
]

# reverse vs reverse_lazy
from django.urls import reverse, reverse_lazy
from django.views.generic import CreateView

# reverse_lazy –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∫–ª–∞—Å—Å–∞
class BookCreateView(CreateView):
    model = Book
    fields = ['title', 'price']
    success_url = reverse_lazy('books:list')  # –õ–µ–Ω–∏–≤–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ

# reverse –≤ –º–µ—Ç–æ–¥–∞—Ö
def my_view(request):
    url = reverse('books:detail', kwargs={'pk': 1})
    return redirect(url)

# –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä
class YearConverter:
    regex = '[0-9]{4}'
    def to_python(self, value): return int(value)
    def to_url(self, value): return f'{value:04d}'

from django.urls import register_converter
register_converter(YearConverter, 'yyyy')
# path('archive/<yyyy:year>/', ...)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: reverse_lazy –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö –∫–ª–∞—Å—Å–æ–≤, namespace –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.</div>
          </div>


          <!-- Files Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏</h3>
            <p class="text-slate-300 mb-3">File, ContentFile, ImageField, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># models.py
from django.db import models
from django.core.validators import FileExtensionValidator

def upload_to_path(instance, filename):
    return f'uploads/{instance.user.id}/{filename}'

class Document(models.Model):
    user = models.ForeignKey('auth.User', on_delete=models.CASCADE)
    file = models.FileField(
        upload_to=upload_to_path,
        validators=[FileExtensionValidator(['pdf', 'doc', 'docx'])]
    )
    image = models.ImageField(upload_to='images/', blank=True)

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
from django.core.exceptions import ValidationError

def validate_file_size(value):
    limit = 2 * 1024 * 1024  # 2MB
    if value.size > limit:
        raise ValidationError('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 2MB)')

class Photo(models.Model):
    image = models.ImageField(upload_to='photos/', validators=[validate_file_size])

# views.py - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
from django.core.files import File
from django.core.files.base import ContentFile

def upload_view(request):
    if request.method == 'POST' and request.FILES.get('file'):
        uploaded_file = request.FILES['file']
        
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
        print(f"Name: {uploaded_file.name}")
        print(f"Size: {uploaded_file.size}")
        print(f"Content-Type: {uploaded_file.content_type}")
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –º–æ–¥–µ–ª—å
        doc = Document(user=request.user)
        doc.file.save(uploaded_file.name, uploaded_file)
        
        # –ò–ª–∏ —á–µ—Ä–µ–∑ default_storage
        from django.core.files.storage import default_storage
        path = default_storage.save(f'uploads/{uploaded_file.name}', uploaded_file)
        url = default_storage.url(path)
        
        return JsonResponse({'url': url})
    
    return render(request, 'upload.html')

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
def generate_file(request):
    content = "File content here"
    file = ContentFile(content.encode('utf-8'))
    
    doc = Document(user=request.user)
    doc.file.save('generated.txt', file)
    
    return HttpResponse('File created')
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: FileExtensionValidator –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞, upload_to —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π, ContentFile –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–º—è—Ç–∏.</div>
          </div>

        <!-- Sessions -->
        <section id="sessions" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">7. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏</h2>
          <p class="text-slate-300 mb-4">request.session —Å –º–µ—Ç–æ–¥–∞–º–∏ set/get/pop/flush/cycle_key.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">def set_session(request):
    request.session['theme'] = 'dark'
    request.session.set_expiry(3600)  # 1 —á–∞—Å
    return HttpResponse('ok')

def get_session(request):
    theme = request.session.get('theme', 'light')
    return JsonResponse({'theme': theme})

def pop_session(request):
    request.session.pop('theme', None)
    return HttpResponse('popped')

def reset_session(request):
    request.session.flush()  # —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –º–µ–Ω—è–µ—Ç –∫–ª—é—á
    request.session.cycle_key()
    return HttpResponse('flushed')
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–∫–æ—Ä–∑–∏–Ω—ã, flash-—Å–æ–æ–±—â–µ–Ω–∏—è.</div>
        </section>


          <!-- i18n Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h3>
            <p class="text-slate-300 mb-3">ngettext, pgettext, npgettext –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤. –¢–µ–≥–∏ trans/blocktrans –≤ —à–∞–±–ª–æ–Ω–∞—Ö.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.utils.translation import (
    gettext as _,
    gettext_lazy as _lazy,
    ngettext,
    pgettext,
    npgettext,
    activate,
    deactivate,
    get_language,
)

# –ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–≤–æ–¥
text = _('Hello')

# Lazy –ø–µ—Ä–µ–≤–æ–¥ (–¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∫–ª–∞—Å—Å–∞)
class MyForm(forms.Form):
    name = forms.CharField(label=_lazy('Name'))

# –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ
count = 5
message = ngettext(
    'You have %(count)d apple',
    'You have %(count)d apples',
    count
) % {'count': count}

# –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ (–µ—Å–ª–∏ —Å–ª–æ–≤–æ –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
text1 = pgettext('verb', 'Close')   # –ó–∞–∫—Ä—ã—Ç—å (–¥–µ–π—Å—Ç–≤–∏–µ)
text2 = pgettext('adjective', 'Close')  # –ë–ª–∏–∑–∫–∏–π (–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ)

# –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ + –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ
npgettext('food', 'apple', 'apples', count)

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
activate('ru')
current = get_language()  # 'ru'
deactivate()  # –í–µ—Ä–Ω—É—Ç—å –∫ DEFAULT

# –í —à–∞–±–ª–æ–Ω–∞—Ö
# {% load i18n %}
# {% trans "Hello" %}
# {% blocktrans %}Text with {{ variable }}{% endblocktrans %}
# {% language 'en' %}English content{% endlanguage %}

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (–∫–æ–º–∞–Ω–¥—ã)
# python manage.py makemessages -l ru
# python manage.py compilemessages
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: ngettext –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞, pgettext –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤, trans/blocktrans –≤ —à–∞–±–ª–æ–Ω–∞—Ö, activate() –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞.</div>
          </div>

        <!-- Cookies -->
        <section id="cookies" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">8. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Cookies</h2>
          <p class="text-slate-300 mb-4">set_cookie(), delete_cookie(), request.COOKIES.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">def set_cookie_view(request):
    resp = HttpResponse('cookie set')
    resp.set_cookie('lang', 'ru', max_age=7*24*3600, httponly=True, samesite='Lax')
    return resp

def get_cookie_view(request):
    lang = request.COOKIES.get('lang', 'en')
    return JsonResponse({'lang': lang})

def delete_cookie_view(request):
    resp = HttpResponse('cookie removed')
    resp.delete_cookie('lang')
    return resp
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Å–æ–≥–ª–∞—Å–∏—è (—É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∑–∞–∫–æ–Ω—ã –∏ –ø–æ–ª–∏—Ç–∏–∫—É –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏).</div>
        </section>


          <!-- Serialization Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è</h3>
            <p class="text-slate-300 mb-3">–†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (json, xml, yaml), natural keys, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–µ–π –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.core import serializers
from .models import Book

# JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
json_data = serializers.serialize('json', Book.objects.all())
json_data = serializers.serialize('json', Book.objects.all(), 
                                    fields=['title', 'price'])  # –¢–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–æ–ª—è

# XML —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
xml_data = serializers.serialize('xml', Book.objects.all())

# –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
for obj in serializers.deserialize('json', json_data):
    instance = obj.object  # –≠–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏
    instance.save()

# Natural keys - —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
class Author(models.Model):
    name = models.CharField(max_length=120, unique=True)
    
    def natural_key(self):
        return (self.name,)
    
    class Meta:
        unique_together = [['name']]

class AuthorManager(models.Manager):
    def get_by_natural_key(self, name):
        return self.get(name=name)

class Author(models.Model):
    objects = AuthorManager()
    # ...

# –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å natural keys
json_data = serializers.serialize('json', Book.objects.all(), use_natural_foreign_keys=True)

# –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
# python manage.py dumpdata app.Book --indent 2 --output books.json
# python manage.py dumpdata --natural-foreign --natural-primary
# python manage.py loaddata books.json
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: dumpdata/loaddata –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, natural keys –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã—Ö —Ñ–∏–∫—Å—Ç—É—Ä, fields –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.</div>
          </div>

        <!-- Signals -->
        <section id="signals" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">9. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">pre_save, post_save, pre_delete, post_delete, m2m_changed, @receiver.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># signals.py
from django.db.models.signals import pre_save, post_save, pre_delete, post_delete, m2m_changed
from django.dispatch import receiver
from .models import Book

@receiver(pre_save, sender=Book)
def before_book_save(sender, instance, **kwargs):
    if instance.title:
        instance.title = instance.title.strip()

@receiver(post_save, sender=Book)
def after_book_save(sender, instance, created, **kwargs):
    if created:
        print('–°–æ–∑–¥–∞–Ω–∞ –∫–Ω–∏–≥–∞', instance.pk)

@receiver(pre_delete, sender=Book)
def before_book_delete(sender, instance, **kwargs):
    print('–£–¥–∞–ª—è–µ—Ç—Å—è –∫–Ω–∏–≥–∞', instance.pk)
</code></pre>
          </div>
          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mt-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># m2m_changed: –ø—Ä–∏–º–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from django.contrib.auth import get_user_model
from django.db.models.signals import m2m_changed
from django.dispatch import receiver

User = get_user_model()

@receiver(m2m_changed, sender=User.groups.through)
def user_groups_changed(sender, instance, action, reverse, model, pk_set, **kwargs):
    if action in {"post_add", "post_remove"}:
        print("–ì—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–µ–Ω—ã:", instance.pk, action, pk_set)
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (–∏–∑–±–µ–≥–∞–π—Ç–µ —Ç—è–∂—ë–ª–æ–π –ª–æ–≥–∏–∫–∏).</div>
        </section>


          <!-- Utils Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã</h3>
            <p class="text-slate-300 mb-3">escape, conditional_escape, format_html, html_safe, json_script, cached_property, classproperty.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.utils.html import escape, conditional_escape, format_html, html_safe, json_script
from django.utils.functional import cached_property
from django.utils.text import slugify

# –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
safe_text = escape('<script>alert("xss")</script>')
# &lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;

# –£—Å–ª–æ–≤–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
text = conditional_escape(user_input)

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
html = format_html('<a href="{}">Link to {}</a>', url, title)

# –ü–æ–º–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π (–∏–∑–±–µ–≥–∞–π—Ç–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞!)
from django.utils.safestring import mark_safe
html = mark_safe('<b>Bold</b>')

# JSON –≤ —à–∞–±–ª–æ–Ω–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
# {% load static %}
# {{ data|json_script:"my-data" }}
# –°–æ–∑–¥–∞—Å—Ç: <script id="my-data" type="application/json">...</script>
# const data = JSON.parse(document.getElementById('my-data').textContent);

# cached_property - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
class Book(models.Model):
    title = models.CharField(max_length=200)
    
    @cached_property
    def expensive_calc(self):
        # –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
        return self.compute_something()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
book = Book.objects.first()
result = book.expensive_calc  # –í—ã—á–∏—Å–ª—è–µ—Ç
result = book.expensive_calc  # –ë–µ—Ä—ë—Ç –∏–∑ –∫—ç—à–∞

# slugify - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ URL-—Å–ª–∞–≥
from django.utils.text import slugify
slug = slugify('–ü—Ä–∏–≤–µ—Ç –ú–∏—Ä!')  # 'privet-mir'
slug = slugify('Hello World', allow_unicode=True)  # 'hello-world'

# import_string - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç
from django.utils.module_loading import import_string
MyClass = import_string('myapp.models.MyClass')
instance = MyClass()

# ContentType –¥–ª—è generic relations
from django.contrib.contenttypes.models import ContentType
from .models import Book

ct = ContentType.objects.get_for_model(Book)
model_class = ct.model_class()  # –ö–ª–∞—Å—Å –º–æ–¥–µ–ª–∏ Book

# apps - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
from django.apps import apps
Book = apps.get_model('app', 'Book')
all_models = apps.get_app_config('app').get_models()
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: format_html –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ HTML, cached_property –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, slugify –¥–ª—è URL, import_string –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤, ContentType –¥–ª—è generic relations.</div>
          </div>

        <!-- Cache -->
        <section id="cache" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">10. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º</h2>
          <p class="text-slate-300 mb-4">cache.get/set/delete/clear, @cache_page, @vary_on_cookie().</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.core.cache import cache

# –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API
cache.set('homepage_html', '&lt;html&gt;...&lt;/html&gt;', timeout=300)
html = cache.get('homepage_html')
cache.delete('homepage_html')
cache.clear()
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.views.decorators.cache import cache_page
from django.views.decorators.vary import vary_on_cookie

@vary_on_cookie
@cache_page(60 * 5)  # 5 –º–∏–Ω—É—Ç
def cached_view(request):
    ...
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –¥–æ—Ä–æ–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã; –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–π—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π backend –∏ –∫–ª—é—á–∏.</div>
        </section>


          <!-- Cache Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫—ç—à–∞</h3>
            <p class="text-slate-300 mb-3">add, get_or_set, set_many, get_many, delete_many, incr, decr, touch –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.core.cache import cache

# add - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
cache.add('key', 'value', timeout=300)  # False –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å

# get_or_set - –ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
value = cache.get_or_set('key', lambda: expensive_calc(), timeout=600)

# –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
cache.set_many({'a': 1, 'b': 2, 'c': 3}, timeout=300)
values = cache.get_many(['a', 'b', 'c'])  # {'a': 1, 'b': 2, 'c': 3}
cache.delete_many(['a', 'b'])

# –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç/–¥–µ–∫—Ä–µ–º–µ–Ω—Ç (–¥–ª—è —Å—á—ë—Ç—á–∏–∫–æ–≤)
cache.set('counter', 0)
cache.incr('counter')  # 1
cache.incr('counter', delta=5)  # 6
cache.decr('counter')  # 5

# touch - –æ–±–Ω–æ–≤–∏—Ç—å TTL –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è
cache.touch('key', timeout=900)

# –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
from django.views.decorators.cache import cache_page, never_cache, cache_control

@cache_page(60 * 15)  # 15 –º–∏–Ω—É—Ç
def my_view(request):
    ...

@never_cache
def always_fresh(request):
    ...

@cache_control(private=True, max_age=3600)
def controlled(request):
    ...
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: get_or_set –¥–ª—è –ª–µ–Ω–∏–≤–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, set_many/get_many –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π, incr/decr –¥–ª—è —Å—á—ë—Ç—á–∏–∫–æ–≤ –±–µ–∑ race conditions, touch –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è TTL.</div>
          </div>

        <!-- Logging -->
        <section id="logging" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">11. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
          <p class="text-slate-300 mb-4">logging.getLogger(), –º–µ—Ç–æ–¥—ã logger.debug/info/warning/error.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">import logging
from django.http import HttpResponse

logger = logging.getLogger(__name__)

def view(request):
    logger.info('User=%s path=%s', request.user, request.path)
    try:
        1 / 0
    except Exception:
        logger.exception('Unexpected error')
    return HttpResponse('ok')
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞, –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π, –æ—Ç–ª–∞–¥–∫–∞. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ settings.LOGGING.</div>
        </section>

        <!-- Files -->
        <section id="files" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">12. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">request.FILES, default_storage, FileSystemStorage, –ø—É—Ç–∏.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># forms.py
from django import forms

class UploadForm(forms.Form):
    file = forms.FileField()
</code></pre>
          </div>
          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># views.py
from django.core.files.storage import default_storage, FileSystemStorage
from django.conf import settings
from django.http import JsonResponse
from django.shortcuts import render
from .forms import UploadForm


def upload(request):
    if request.method == 'POST':
        form = UploadForm(request.POST, request.FILES)
        if form.is_valid():
            f = form.cleaned_data['file']
            # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ MEDIA_ROOT/ uploads/
            path = default_storage.save(f"uploads/{f.name}", f)
            return JsonResponse({'path': path})
    else:
        form = UploadForm()
    return render(request, 'upload.html', {'form': form})

# –ö–∞—Å—Ç–æ–º–Ω—ã–π FileSystemStorage
media_storage = FileSystemStorage(location=settings.MEDIA_ROOT, base_url=settings.MEDIA_URL)
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞, –¥–æ—Å—Ç—É–ø –∫ –ø—É—Ç—è–º MEDIA_ROOT/MEDIA_URL.</div>
        </section>

        <!-- JSON -->
        <section id="json" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">13. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON</h2>
          <p class="text-slate-300 mb-4">json.dumps()/loads(), JSONField, JsonResponse.</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">import json
from django.http import JsonResponse

# Python -&gt; JSON —Å—Ç—Ä–æ–∫–∞
s = json.dumps({'a': 1})
obj = json.loads(s)

# Django JsonResponse
return JsonResponse({'ok': True})
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># models.py ‚Äî JSONField
from django.db import models

class Profile(models.Model):
    user = models.OneToOneField('auth.User', on_delete=models.CASCADE)
    settings = models.JSONField(default=dict)
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–∏–±–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, API –æ—Ç–≤–µ—Ç—ã, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π.</div>
        </section>

        <!-- Migrations -->
        <section id="migrations" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">14. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏</h2>
          <p class="text-slate-300 mb-4">CreateModel, AddField, RemoveField, AlterField, RenameModel, RunPython.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># –ü—Ä–∏–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ RunPython
from django.db import migrations

def forwards(apps, schema_editor):
    Book = apps.get_model('app', 'Book')
    for b in Book.objects.filter(stock__lt=0):
        b.stock = 0
        b.save(update_fields=['stock'])

def backwards(apps, schema_editor):
    pass

class Migration(migrations.Migration):
    dependencies = [('app', '0001_initial')]
    operations = [
        migrations.RunPython(forwards, backwards),
    ]
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π.</div>
        </section>


          <!-- Migrations Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π</h3>
            <p class="text-slate-300 mb-3">RunSQL, CreateModel, AddField, RemoveField, AlterField, RenameModel, RenameField, AddIndex, RemoveIndex, AddConstraint, RemoveConstraint.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db import migrations, models

# RunPython –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
def forwards(apps, schema_editor):
    Book = apps.get_model('app', 'Book')
    for book in Book.objects.filter(stock__lt=0):
        book.stock = 0
        book.save()

def backwards(apps, schema_editor):
    pass

class Migration(migrations.Migration):
    dependencies = [('app', '0001_initial')]
    operations = [
        migrations.RunPython(forwards, backwards),
    ]

# RunSQL –¥–ª—è —Å—ã—Ä–æ–≥–æ SQL
class Migration(migrations.Migration):
    operations = [
        migrations.RunSQL(
            "CREATE INDEX idx_title ON app_book (title)",
            reverse_sql="DROP INDEX idx_title"
        ),
    ]

# –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ö–µ–º–æ–π
operations = [
    migrations.AddField('Book', 'rating', models.IntegerField(default=0)),
    migrations.RemoveField('Book', 'old_field'),
    migrations.AlterField('Book', 'price', models.DecimalField(max_digits=12, decimal_places=2)),
    migrations.RenameField('Book', 'old_name', 'new_name'),
    migrations.RenameModel('OldName', 'NewName'),
    migrations.AddIndex('Book', models.Index(fields=['title', 'author'], name='idx_book_title_author')),
    migrations.AddConstraint('Book', models.CheckConstraint(check=models.Q(price__gte=0), name='price_positive')),
]
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: RunPython –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, RunSQL –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π, –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ö–µ–º–æ–π –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü.</div>
          </div>

        <!-- Admin -->
        <section id="admin" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">15. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Admin –ø–∞–Ω–µ–ª—å—é</h2>
          <p class="text-slate-300 mb-4">list_display, list_filter, search_fields, readonly_fields, inlines, actions.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># admin.py
from django.contrib import admin
from .models import Book, Order, OrderItem

class OrderItemInline(admin.TabularInline):
    model = OrderItem
    extra = 0

@admin.register(Book)
class BookAdmin(admin.ModelAdmin):
    list_display = ('id', 'title', 'author', 'price', 'stock')
    list_filter = ('author', 'category')
    search_fields = ('title', 'author__name')
    readonly_fields = ()
    actions = ['set_zero_stock']

    @admin.action(description='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ = 0')
    def set_zero_stock(self, request, queryset):
        queryset.update(stock=0)

@admin.register(Order)
class OrderAdmin(admin.ModelAdmin):
    inlines = [OrderItemInline]
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –≥—Ä—É–ø–ø–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ actions.</div>
        </section>


          <!-- Admin Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Admin</h3>
            <p class="text-slate-300 mb-3">list_editable, ordering, date_hierarchy, fieldsets, get_queryset, formfield_overrides –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∞–¥–º–∏–Ω–∫–∏.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.contrib import admin
from .models import Book

@admin.register(Book)
class BookAdmin(admin.ModelAdmin):
    list_display = ('id', 'title', 'author', 'price', 'stock', 'published_at')
    list_filter = ('author', 'category', 'published_at')
    search_fields = ('title', 'author__name')
    list_editable = ('price', 'stock')  # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä—è–º–æ –≤ —Å–ø–∏—Å–∫–µ
    ordering = ('-published_at', 'title')
    date_hierarchy = 'published_at'  # –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
    list_per_page = 50
    
    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π –≤ —Ñ–æ—Ä–º–µ
    fieldsets = (
        ('–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', {
            'fields': ('title', 'author', 'category')
        }),
        ('–¶–µ–Ω—ã –∏ —Å–∫–ª–∞–¥', {
            'fields': ('price', 'stock'),
            'classes': ('collapse',)  # –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–∞—è —Å–µ–∫—Ü–∏—è
        }),
    )
    
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è QuerySet
    def get_queryset(self, request):
        qs = super().get_queryset(request)
        if not request.user.is_superuser:
            qs = qs.filter(author__is_active=True)
        return qs
    
    # –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
    formfield_overrides = {
        models.TextField: {'widget': forms.Textarea(attrs={'rows': 4, 'cols': 60})},
    }
    
    # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    @admin.action(description='–°–Ω–∏–∑–∏—Ç—å —Ü–µ–Ω—É –Ω–∞ 10%')
    def discount_10(self, request, queryset):
        queryset.update(price=models.F('price') * 0.9)
    
    actions = [discount_10]
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: list_editable –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, fieldsets –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º—ã, get_queryset –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, actions –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.</div>
          </div>

        <!-- i18n -->
        <section id="i18n" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">16. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
          <p class="text-slate-300 mb-4">gettext(), gettext_lazy(), activate(), get_language(), LANGUAGE_CODE, LANGUAGES.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">from django.utils.translation import gettext as _, gettext_lazy as _lazy
from django.utils.translation import activate, get_language

# –ü–µ—Ä–µ–≤–æ–¥ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
text = _('Hello')
# Lazy –ø–µ—Ä–µ–≤–æ–¥ (–≤ –º–æ–¥–µ–ª—è—Ö/—Ñ–æ—Ä–º–∞—Ö)
label = _lazy('Name')

activate('ru')
current = get_language()  # 'ru'
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, email –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</div>
        </section>

        <!-- Time -->
        <section id="time" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">17. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ –¥–∞—Ç–æ–π</h2>
          <p class="text-slate-300 mb-4">timezone.now(), DateField, DateTimeField, auto_now, auto_now_add.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">from django.utils import timezone
from django.db import models

class Event(models.Model):
    name = models.CharField(max_length=120)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    start_date = models.DateField()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
now = timezone.now()
upcoming = Event.objects.filter(start_date__gte=timezone.now().date())
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ç–∞–π–º–∑–æ–Ω—ã-aware –≤—Ä–µ–º—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.</div>
        </section>


          <!-- Time Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–µ–º</h3>
            <p class="text-slate-300 mb-3">timezone.localtime, make_aware, make_naive, is_aware, is_naive –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.utils import timezone
from datetime import datetime, timedelta
import pytz

# –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timezone-aware)
now = timezone.now()

# –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ timezone
local_now = timezone.localtime(now)

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è naive <-> aware
naive_dt = datetime(2024, 1, 1, 12, 0)
aware_dt = timezone.make_aware(naive_dt, timezone=pytz.UTC)

naive_again = timezone.make_naive(aware_dt, timezone=pytz.UTC)

# –ü—Ä–æ–≤–µ—Ä–∫–∞
timezone.is_aware(aware_dt)  # True
timezone.is_naive(naive_dt)  # True

# –†–∞–±–æ—Ç–∞ —Å timedelta
tomorrow = now + timedelta(days=1)
next_week = now + timedelta(weeks=1)
hour_ago = now - timedelta(hours=1)

# –í –º–æ–¥–µ–ª—è—Ö
from django.db import models

class Event(models.Model):
    name = models.CharField(max_length=120)
    created_at = models.DateTimeField(auto_now_add=True)  # –¢–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    updated_at = models.DateTimeField(auto_now=True)      # –ü—Ä–∏ –∫–∞–∂–¥–æ–º save()
    start_date = models.DateField()
    start_time = models.TimeField()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
upcoming = Event.objects.filter(start_date__gte=timezone.now().date())
recent = Event.objects.filter(created_at__gte=timezone.now() - timedelta(days=7))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: timezone.now() –≤–º–µ—Å—Ç–æ datetime.now() –¥–ª—è timezone-aware –≤—Ä–µ–º–µ–Ω–∏, make_aware –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö, localtime –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</div>
          </div>

        <!-- Testing -->
        <section id="testing" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">18. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
          <p class="text-slate-300 mb-4">TestCase, Client, RequestFactory, fixtures, @override_settings().</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># tests.py
from django.test import TestCase, Client, RequestFactory, override_settings
from django.urls import reverse
from .models import Book, Author

class ViewsTest(TestCase):
    fixtures = ['books.json']

    def setUp(self):
        self.client = Client()
        self.factory = RequestFactory()
        self.author = Author.objects.create(name='Tom')
        self.book = Book.objects.create(title='Django', author=self.author, price=10, stock=1)

    def test_home(self):
        resp = self.client.get(reverse('home'))
        self.assertEqual(resp.status_code, 200)

    @override_settings(DEBUG=True)
    def test_override(self):
        self.assertTrue(True)
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—å—é—Ö, –º–æ–¥–µ–ª–µ–π –∏ API; override_settings –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è.</div>
        </section>


          <!-- Testing Advanced -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <p class="text-slate-300 mb-3">TransactionTestCase, SimpleTestCase, assertContains, assertRedirects, setUpTestData –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.test import TestCase, TransactionTestCase, SimpleTestCase, Client, override_settings
from django.urls import reverse
from .models import Book, Author

class BookTestCase(TestCase):
    @classmethod
    def setUpTestData(cls):
        # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–±—ã—Å—Ç—Ä–µ–µ)
        cls.author = Author.objects.create(name='Test Author')
        cls.book = Book.objects.create(title='Test Book', author=cls.author, price=10, stock=5)
    
    def setUp(self):
        # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
        self.client = Client()
    
    def test_book_list(self):
        response = self.client.get(reverse('book-list'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Test Book')
        self.assertNotContains(response, 'Should not be here')
    
    def test_redirect(self):
        response = self.client.get(reverse('old-url'))
        self.assertRedirects(response, reverse('new-url'))
    
    def test_queryset(self):
        books = Book.objects.filter(price__gte=5)
        self.assertQuerysetEqual(
            books,
            [self.book],
            transform=lambda x: x
        )
    
    @override_settings(DEBUG=True)
    def test_with_settings(self):
        from django.conf import settings
        self.assertTrue(settings.DEBUG)

# TransactionTestCase - –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
class TransactionTest(TransactionTestCase):
    def test_transaction(self):
        # –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –ë–î
        ...

# SimpleTestCase - –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î (–±—ã—Å—Ç—Ä–µ–µ)
class SimpleTest(SimpleTestCase):
    def test_homepage(self):
        response = self.client.get('/')
        self.assertEqual(response.status_code, 200)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: setUpTestData –¥–ª—è —Ñ–∏–∫—Å—Ç—É—Ä (–±—ã—Å—Ç—Ä–µ–µ setUp), assertContains/assertRedirects –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—å—é—Ö, TransactionTestCase –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, SimpleTestCase –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –ë–î.</div>
          </div>

        <!-- Serialization -->
        <section id="serialization" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">19. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
          <p class="text-slate-300 mb-4">serialize(), deserialize(), –∫–æ–º–∞–Ω–¥—ã dumpdata/loaddata.</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.core import serializers

# –í JSON
data = serializers.serialize('json', Book.objects.all())

# –û–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç—ã
for obj in serializers.deserialize('json', data):
    instance = obj.object
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-bash"># –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
python manage.py dumpdata app.Book --indent 2 &gt; books.json
python manage.py loaddata books.json
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤.</div>
        </section>

        <!-- Utils -->
        <section id="utils" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">20. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã</h2>
          <p class="text-slate-300 mb-4">slugify(), mark_safe(), hashlib, secrets, apps, ContentType, import_string().</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.utils.text import slugify
from django.utils.safestring import mark_safe
from django.contrib.contenttypes.models import ContentType
from django.apps import apps
from django.utils.module_loading import import_string
import hashlib, secrets

slug = slugify('–ü—Ä–∏–≤–µ—Ç –ú–∏—Ä!')  # privet-mir
safe_html = mark_safe('<b>–ù–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</b>')

# –•—ç—à–∏/—Å–µ–∫—Ä–µ—Ç—ã
sha = hashlib.sha256(b'data').hexdigest()
token = secrets.token_urlsafe(32)

# ContentType –∏ apps
ct = ContentType.objects.get_for_model(Book)
BookModel = apps.get_model('app', 'Book')

# import_string –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
klass = import_string('path.to.Class')
</code></pre>
            </div>
            <div class="section-card p-4">
              <h3 class="text-lg font-semibold text-amber-300 mb-2">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
              <ul class="list-disc list-inside text-slate-300 text-sm space-y-1">
                <li>slugify –¥–ª—è URL-—Å–ª–µ–≥–æ–≤</li>
                <li>mark_safe —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ HTML</li>
                <li>hashlib/secrets –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ —Ç–æ–∫–µ–Ω–æ–≤</li>
                <li>apps/ContentType –¥–ª—è generic —Å–≤—è–∑–µ–π –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</li>
                <li>import_string –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π</li>
              </ul>
            </div>
          </div>
        </section>

      </main>
    </div>

    <footer class="mt-10 text-center text-slate-500 text-sm">
      Django 5.0+ ‚Äî –®–ø–∞—Ä–≥–∞–ª–∫–∞. –¢—ë–º–Ω–∞—è —Ç–µ–º–∞, Tailwind v4, highlight.js. –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.
    </footer>
  </div>

  <script>
    // highlight.js init
    hljs.highlightAll();

    // Copy code helper
    function textFromCodeButton(btn) {
      const pre = btn.parentElement.querySelector('pre');
      if (!pre) return '';
      return pre.innerText.replace(/\n$/, '');
    }
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const code = textFromCodeButton(btn);
        try {
          await navigator.clipboard.writeText(code);
          const prev = btn.textContent;
          btn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
          btn.classList.add('bg-emerald-700');
          setTimeout(() => { btn.textContent = prev; btn.classList.remove('bg-emerald-700'); }, 1600);
        } catch (e) {
          btn.textContent = '‚úó –û—à–∏–±–∫–∞';
        }
      })
    });

    // Smooth scroll for anchors
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', (e) => {
        const id = a.getAttribute('href');
        const target = document.querySelector(id);
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      })
    });

    // Active section highlight in TOC
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');
          document.querySelectorAll('#toc a').forEach(link => link.classList.remove('text-sky-400', 'font-semibold'));
          const active = document.querySelector(`#toc a[href="#${id}"]`);
          if (active) { active.classList.add('text-sky-400', 'font-semibold'); }
        }
      })
    }, { rootMargin: '-20% 0px -70% 0px' });
    document.querySelectorAll('section[id]').forEach(sec => observer.observe(sec));
  </script>
</body>
</html>
