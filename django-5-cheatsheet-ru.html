<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Django 5.0+ ‚Äî –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º –∏ API</title>
  <!-- Tailwind CSS v4 via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- highlight.js (dark theme) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <style>
    :root { color-scheme: dark; }
    body { background: #0b1220; color: #dbe7ff; }
    .section-card { background: #0f172a; border: 1px solid #1e293b; border-radius: 0.75rem; }
    .code-block pre { background: #0b1220 !important; margin: 0 !important; border-radius: 0.5rem; }
    .copy-btn { opacity: 0; transition: opacity 0.15s ease; }
    .code-block:hover .copy-btn { opacity: 1; }
    #toc { scrollbar-width: thin; scrollbar-color: #475569 #0b1220; }
    #toc::-webkit-scrollbar { width: 6px; }
    #toc::-webkit-scrollbar-track { background: #0b1220; border-radius: 4px; }
    #toc::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    #toc::-webkit-scrollbar-thumb:hover { background: #475569; }
    @media (max-width: 1024px) { #toc { display: none; } }
  </style>
</head>
<body class="font-sans antialiased">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-[#0b1220]/90 backdrop-blur border-b border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex flex-col sm:flex-row items-center gap-3 justify-between">
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">
            <span class="bg-gradient-to-r from-sky-400 to-purple-400 bg-clip-text text-transparent">Django 5.0+ ‚Äî –®–ø–∞—Ä–≥–∞–ª–∫–∞</span>
          </h1>
          <p class="text-slate-400 text-sm sm:text-base">–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, API –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –¢—ë–º–Ω–∞—è —Ç–µ–º–∞, –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–¥–∞.</p>
        </div>
        <div class="flex gap-2 text-xs text-slate-400">
          <span class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700">Tailwind v4</span>
          <span class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700">highlight.js</span>
          <span class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700">Dark UI</span>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Quick Reference Table -->
    <section id="quick-ref" class="section-card p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4 text-sky-400">üìã –ë—ã—Å—Ç—Ä—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="text-slate-300 border-b border-slate-700/60">
              <th class="py-2 pr-4">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th class="py-2">–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/–æ–±—ä–µ–∫—Ç—ã</th>
            </tr>
          </thead>
          <tbody class="align-top">
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">ORM –∏ QuerySet</td>
              <td class="py-3 text-slate-300">Q, F, Count, Sum, Avg, Min, Max, Case/When, Exists, Subquery, Window, select_related, prefetch_related, filter, exclude, get, all, values, values_list, annotate, aggregate, order_by, distinct, update, delete</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–§–æ—Ä–º—ã</td>
              <td class="py-3 text-slate-300">Form, ModelForm, formset_factory, inlineformset_factory, –ø–æ–ª—è, –≤–∏–¥–∂–µ—Ç—ã, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</td>
              <td class="py-3 text-slate-300">authenticate, login, logout, get_user_model, Permission, Group, has_perm, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">HTTP</td>
              <td class="py-3 text-slate-300">HttpResponse, JsonResponse, FileResponse, StreamingHttpResponse, redirect, reverse</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–®–∞–±–ª–æ–Ω—ã</td>
              <td class="py-3 text-slate-300">render, render_to_string, —Ç–µ–≥–∏: if, for, block, extends, include, url, static, csrf_token; —Ñ–∏–ª—å—Ç—Ä—ã: upper, lower, date, truncatewords</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">URL</td>
              <td class="py-3 text-slate-300">path, re_path, include, reverse, get_absolute_url, converters</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–°–µ—Å—Å–∏–∏</td>
              <td class="py-3 text-slate-300">request.session set/get/pop/flush/cycle_key</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">Cookies</td>
              <td class="py-3 text-slate-300">set_cookie, delete_cookie, request.COOKIES</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–°–∏–≥–Ω–∞–ª—ã</td>
              <td class="py-3 text-slate-300">pre_save, post_save, pre_delete, post_delete, m2m_changed, @receiver</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–ö—ç—à</td>
              <td class="py-3 text-slate-300">cache.get/set/delete/clear, @cache_page, @vary_on_cookie</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</td>
              <td class="py-3 text-slate-300">logging.getLogger, logger.debug/info/warning/error</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–§–∞–π–ª—ã</td>
              <td class="py-3 text-slate-300">request.FILES, default_storage, FileSystemStorage, –ø—É—Ç–∏</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">JSON</td>
              <td class="py-3 text-slate-300">json.dumps/loads, JSONField, JsonResponse</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–ú–∏–≥—Ä–∞—Ü–∏–∏</td>
              <td class="py-3 text-slate-300">CreateModel, AddField, RemoveField, AlterField, RenameModel, RunPython</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">Admin</td>
              <td class="py-3 text-slate-300">list_display, list_filter, search_fields, readonly_fields, inlines, actions</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">i18n</td>
              <td class="py-3 text-slate-300">gettext/gettext_lazy, activate, get_language, LANGUAGE_CODE, LANGUAGES</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</td>
              <td class="py-3 text-slate-300">timezone.now, DateField, DateTimeField, auto_now, auto_now_add</td>
            </tr>
            <tr class="border-b border-slate-800/70">
              <td class="py-3 pr-4 font-semibold">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</td>
              <td class="py-3 text-slate-300">TestCase, Client, RequestFactory, fixtures, @override_settings</td>
            </tr>
            <tr>
              <td class="py-3 pr-4 font-semibold">–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã</td>
              <td class="py-3 text-slate-300">serialize/deserialize, dumpdata/loaddata, slugify, mark_safe, hashlib, secrets, apps, ContentType, import_string</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <div class="flex gap-6">
      <!-- TOC -->
      <aside id="toc" class="w-[280px] shrink-0 section-card p-4 h-[calc(100vh-8rem)] sticky top-28 hidden lg:block">
        <h3 class="text-lg font-semibold mb-3 text-purple-300">–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ</h3>
        <nav class="text-sm space-y-2 overflow-y-auto h-[calc(100%-2rem)]">
          <a class="block text-slate-400 hover:text-sky-400" href="#orm">1. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#forms">2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#auth">3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#http">4. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTP</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#templates">5. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#urls">6. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#sessions">7. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#cookies">8. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Cookies</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#signals">9. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#cache">10. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#logging">11. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#files">12. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#json">13. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#migrations">14. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#admin">15. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Admin –ø–∞–Ω–µ–ª—å—é</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#i18n">16. –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (i18n)</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#time">17. –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#testing">18. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#serialization">19. –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è</a>
          <a class="block text-slate-400 hover:text-sky-400" href="#utils">20. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã</a>
        </nav>
      </aside>

      <!-- Main content -->
      <main class="flex-1 space-y-8">
        <!-- ORM & QuerySet -->
        <section id="orm" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">1. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏ (ORM –∏ QuerySet)</h2>
          <p class="text-slate-300 mb-4">–ö–ª—é—á–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏: Q, F, –∞–≥—Ä–µ–≥–∞—Ç—ã (Count, Sum, Avg, Min, Max), Case/When, Exists, Subquery/OuterRef, Window, select_related, prefetch_related, –∞ —Ç–∞–∫–∂–µ –º–µ—Ç–æ–¥—ã QuerySet: filter, exclude, get, all, values, values_list, annotate, aggregate, order_by, distinct, update, delete, create.</p>

          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ú–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># app/models.py
from django.db import models
from django.db.models import Q, F, Count, Sum, Avg, Min, Max, Case, When, IntegerField, Subquery, OuterRef, Exists, Window
from django.db.models.functions import RowNumber

class Author(models.Model):
    name = models.CharField(max_length=120)
    is_active = models.BooleanField(default=True)

class Category(models.Model):
    name = models.CharField(max_length=60)

class Book(models.Model):
    title = models.CharField(max_length=200)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True, blank=True)
    price = models.DecimalField(max_digits=10, decimal_places=2)
    stock = models.IntegerField(default=0)
    published_at = models.DateField(null=True, blank=True)

class Order(models.Model):
    created_at = models.DateTimeField(auto_now_add=True)

class OrderItem(models.Model):
    order = models.ForeignKey(Order, on_delete=models.CASCADE, related_name='items')
    book = models.ForeignKey(Book, on_delete=models.CASCADE)
    qty = models.PositiveIntegerField()
    price = models.DecimalField(max_digits=10, decimal_places=2)
</code></pre>
            </div>
          </div>

          <!-- Q -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Q ‚Äî —Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (AND/OR/NOT)</h3>
            <p class="text-slate-300 mb-3">–û–±—ä–µ–¥–∏–Ω—è–µ—Ç —É—Å–ª–æ–≤–∏—è —Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ | (OR), & (AND), ~ (NOT). –£–¥–æ–±–Ω–æ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Q

# –ù–∞–π—Ç–∏ –∫–Ω–∏–≥–∏ —Å–æ —Å–ª–æ–≤–æ–º "Django" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ò–õ–ò –∫–Ω–∏–≥–∏ —Å–æ —Å–∫–ª–∞–¥–æ–º &gt; 0
qs = Book.objects.filter(Q(title__icontains='django') | Q(stock__gt=0))

# –ò—Å–∫–ª—é—á–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤
qs = Book.objects.filter(~Q(author__is_active=False))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–∏—Å–∫–æ–≤—ã–µ —Ñ–æ—Ä–º—ã, —Å–ª–æ–∂–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –º–Ω–æ–≥–∏–º –ø–æ–ª—è–º, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π.</div>
          </div>

          <!-- F -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">F ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—è –º–æ–¥–µ–ª–∏ (–æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î)</h3>
            <p class="text-slate-300 mb-3">–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç—å.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import F

# –£–≤–µ–ª–∏—á–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ –Ω–∞ 5 –¥–ª—è –≤—Å–µ—Ö –∫–Ω–∏–≥ –∞–≤—Ç–æ—Ä–∞
Book.objects.filter(author__name='Tom').update(stock=F('stock') + 5)

# –í—ã–±—Ä–∞—Ç—å –∫–Ω–∏–≥–∏, –≥–¥–µ —Ü–µ–Ω–∞ &gt;= –∫–æ–ª-–≤–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
qs = Book.objects.filter(price__gte=F('stock'))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã/–¥–µ–∫—Ä–µ–º–µ–Ω—Ç—ã, –º–∞—Å—Å–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–º—è—Ç—å.</div>
          </div>

          <!-- Aggregates -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ê–≥—Ä–µ–≥–∞—Ç—ã: Count, Sum, Avg, Min, Max</h3>
            <p class="text-slate-300 mb-3">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ annotate –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∫ –∫–∞–∂–¥–æ–º—É –æ–±—ä–µ–∫—Ç—É –∏ aggregate –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –≤—Å–µ–º—É –Ω–∞–±–æ—Ä—É.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Count, Sum, Avg, Min, Max

# –ö–æ–ª-–≤–æ –∫–Ω–∏–≥ —É –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
authors = Author.objects.annotate(books_count=Count('book'))

# –ò—Ç–æ–≥–æ –ø—Ä–æ–¥–∞–∂ –ø–æ –∑–∞–∫–∞–∑—É
orders = Order.objects.annotate(total=Sum(F('items__qty') * F('items__price')))

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –∫–Ω–∏–≥–∞–º
stats = Book.objects.aggregate(
    total=Count('id'),
    avg_price=Avg('price'),
    min_price=Min('price'),
    max_price=Max('price'),
)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –æ—Ç—á—ë—Ç—ã, —Å–ø–∏—Å–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏, KPI, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º.</div>
          </div>

          <!-- Case/When -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Case / When ‚Äî —É—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î</h3>
            <p class="text-slate-300 mb-3">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è –∏ —Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ/—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ –Ω–∏–º.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Case, When, IntegerField

qs = Book.objects.annotate(
    availability=Case(
        When(stock__lte=0, then=0),
        When(stock__lt=10, then=1),
        default=2,
        output_field=IntegerField(),
    )
).order_by('-availability')
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –ø—Ä–∞–≤–∏–ª–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</div>
          </div>

          <!-- Exists -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Exists ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π</h3>
            <p class="text-slate-300 mb-3">–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º EXISTS –≤–º–µ—Å—Ç–æ JOIN-–æ–≤/COUNT-–æ–≤.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Exists, OuterRef

has_items = OrderItem.objects.filter(order=OuterRef('pk'))
orders = Order.objects.annotate(has_items=Exists(has_items)).filter(has_items=True)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ñ–∏–ª—å—Ç—Ä ¬´–µ—Å—Ç—å –ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã¬ª, ¬´–µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏¬ª.</div>
          </div>

          <!-- Subquery -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Subquery / OuterRef ‚Äî –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã</h3>
            <p class="text-slate-300 mb-3">–ü–æ–¥—Å—Ç–∞–≤–ª—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Subquery, OuterRef

last_price = (
    OrderItem.objects.filter(book=OuterRef('pk'))
    .order_by('-id')
    .values('price')[:1]
)
qs = Book.objects.annotate(last_sold_price=Subquery(last_price))
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ/–ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã.</div>
          </div>

          <!-- Window -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">Window ‚Äî –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
            <p class="text-slate-300 mb-3">–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –∏–ª–∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.db.models import Window
from django.db.models.functions import RowNumber

ranked = Book.objects.annotate(
    row_number=Window(expression=RowNumber(), order_by=F('price').desc())
)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º, —Å–∫–æ–ª—å–∑—è—â–∏–µ –∞–≥—Ä–µ–≥–∞—Ç—ã (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –°–£–ë–î).</div>
          </div>

          <!-- select_related / prefetch_related -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">select_related / prefetch_related ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è N+1</h3>
            <p class="text-slate-300 mb-3">select_related –¥–µ–ª–∞–µ—Ç JOIN –¥–ª—è ForeignKey/OneToOne, prefetch_related –¥–µ–ª–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞ Python-—Å—Ç–æ—Ä–æ–Ω–µ (–≤ —Ç.—á. ManyToMany –∏ –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–≤—è–∑–∏).</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É/–º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É
books = Book.objects.select_related('author', 'category').all()

# –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º/–æ–±—Ä–∞—Ç–Ω—ã–µ
from django.db.models import Prefetch
items_prefetch = Prefetch('items', queryset=OrderItem.objects.select_related('book'))
orders = Order.objects.prefetch_related(items_prefetch)
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Å–ø–∏—Å–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π; —É—Å—Ç—Ä–∞–Ω—è–µ—Ç N+1 –∑–∞–ø—Ä–æ—Å–æ–≤.</div>
          </div>

          <!-- QuerySet API essentials -->
          <div class="mb-2">
            <h3 class="text-lg font-semibold text-emerald-400 mb-2">–ú–µ—Ç–æ–¥—ã QuerySet: filter, exclude, get, all, values, values_list –∏ –¥—Ä.</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># –ë–∞–∑–æ–≤—ã–µ
Book.objects.all()
Book.objects.filter(price__gte=100)
Book.objects.exclude(stock__lte=0)
Book.objects.get(pk=1)

# –ü–æ–ª—è —Å–ª–æ–≤–∞—Ä—è/—Å–ø–∏—Å–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
Book.objects.values('id', 'title')
Book.objects.values_list('id', flat=True)

# –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏/–∞–≥—Ä–µ–≥–∞—Ü–∏–∏
Book.objects.annotate(num_items=Count('orderitem'))
Book.objects.aggregate(total=Count('id'))

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
Book.objects.order_by('-price', 'title').distinct('title')  # distinct(fields) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ –≤—Å–µ–º–∏ –ë–î

# –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
Book.objects.filter(stock=0).update(stock=5)
Book.objects.filter(price__lt=10).delete()

# –°–æ–∑–¥–∞–Ω–∏–µ
Book.objects.create(title='New', author=Author.objects.first(), price=10, stock=3)
Book.objects.bulk_create([
    Book(title='A', author=Author.objects.first(), price=5, stock=2),
    Book(title='B', author=Author.objects.first(), price=8, stock=4),
])
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏, –≤—ã–±–æ—Ä–∫–∏, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è API –∏ –∞–¥–º–∏–Ω–∫–∏, –æ—Ç—á—ë—Ç—ã.</div>
          </div>
        </section>

        <!-- Forms -->
        <section id="forms" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">–†–∞–±–æ—Ç–∞ —Å Form/ModelForm, –Ω–∞–±–æ—Ä–∞–º–∏ —Ñ–æ—Ä–º, –ø–æ–ª—è–º–∏, –≤–∏–¥–∂–µ—Ç–∞–º–∏ –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏.</p>

          <!-- Form / ModelForm -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">Form / ModelForm ‚Äî –±–∞–∑–æ–≤—ã–µ —Ñ–æ—Ä–º—ã</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># forms.py
from django import forms
from .models import Book

class ContactForm(forms.Form):
    name = forms.CharField(max_length=60)
    email = forms.EmailField()
    message = forms.CharField(widget=forms.Textarea)

class BookForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'author', 'price', 'stock', 'category']
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># views.py
from django.shortcuts import render, redirect
from .forms import ContactForm, BookForm

def contact_view(request):
    if request.method == 'POST':
        form = ContactForm(request.POST)
        if form.is_valid():
            # –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å form.cleaned_data
            return redirect('thanks')
    else:
        form = ContactForm()
    return render(request, 'contact.html', {'form': form})


def book_create(request):
    if request.method == 'POST':
        form = BookForm(request.POST)
        if form.is_valid():
            form.save()
            return redirect('books-list')
    else:
        form = BookForm()
    return render(request, 'book_form.html', {'form': form})
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: HTML-—Ñ–æ—Ä–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.</div>
          </div>

          <!-- Formsets -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">formset_factory / inlineformset_factory ‚Äî –Ω–∞–±–æ—Ä—ã —Ñ–æ—Ä–º</h3>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># forms.py
from django.forms import formset_factory, inlineformset_factory
from .models import Order, OrderItem
from django import forms

class OrderItemForm(forms.ModelForm):
    class Meta:
        model = OrderItem
        fields = ['book', 'qty', 'price']

OrderItemFormSet = inlineformset_factory(
    Order, OrderItem, form=OrderItemForm, extra=1, can_delete=True
)
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mt-3">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># views.py
from django.shortcuts import render, redirect, get_object_or_404
from .forms import OrderItemFormSet
from .models import Order

def order_edit(request, pk):
    order = get_object_or_404(Order, pk=pk)
    formset = OrderItemFormSet(request.POST or None, instance=order)
    if request.method == 'POST' and formset.is_valid():
        formset.save()
        return redirect('orders')
    return render(request, 'order_edit.html', {'formset': formset})
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ (–Ω–∞–ø—Ä., —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞ –∫ –∑–∞–∫–∞–∑—É).</div>
          </div>

          <!-- Fields / Widgets / Validators -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-amber-400 mb-2">–ü–æ–ª—è —Ñ–æ—Ä–º, –≤–∏–¥–∂–µ—Ç—ã, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã</h3>
            <p class="text-slate-300 mb-3">–ß–∞—Å—Ç—ã–µ —Ç–∏–ø—ã –ø–æ–ª–µ–π: CharField, EmailField, IntegerField, FloatField, DecimalField, BooleanField, DateField, DateTimeField, TimeField, URLField, ChoiceField, MultipleChoiceField, ModelChoiceField, ModelMultipleChoiceField, FileField, ImageField, TypedChoiceField, RegexField, SlugField, UUIDField, JSONField.</p>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># forms.py
from django import forms
from django.core.validators import MinValueValidator, MaxValueValidator, RegexValidator
from .models import Book

class DemoForm(forms.Form):
    name = forms.CharField(max_length=50, widget=forms.TextInput(attrs={'class': 'input'}))
    email = forms.EmailField()
    age = forms.IntegerField(validators=[MinValueValidator(0), MaxValueValidator(120)])
    site = forms.URLField(required=False)
    agree = forms.BooleanField(required=False)
    when = forms.DateTimeField(widget=forms.DateTimeInput(attrs={'type': 'datetime-local'}))
    color = forms.ChoiceField(choices=[('r','Red'), ('g','Green')], widget=forms.RadioSelect)
    tags = forms.MultipleChoiceField(choices=[('a','A'), ('b','B')], widget=forms.CheckboxSelectMultiple)
    price = forms.DecimalField(max_digits=8, decimal_places=2)
    slug = forms.SlugField()
    code = forms.RegexField(regex=r'^[A-Z]{3}-\d{3}$', validators=[RegexValidator(r'^[A-Z]{3}-\d{3}$')])
    json = forms.JSONField(required=False)

class BookWidgetForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'author', 'price', 'stock', 'category']
        widgets = {
            'title': forms.TextInput(attrs={'placeholder': '–ù–∞–∑–≤–∞–Ω–∏–µ'}),
            'price': forms.NumberInput(attrs={'min': '0', 'step': '0.01'}),
            'category': forms.Select(attrs={'class': 'select'}),
        }
</code></pre>
            </div>
            <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: UX –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤, —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ä–∞–±–æ—Ç–∞ —Å JSON –≤ —Ñ–æ—Ä–º–∞—Ö.</div>
          </div>
        </section>

        <!-- Auth -->
        <section id="auth" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">3. –§—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
          <p class="text-slate-300 mb-4">–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: authenticate(), login(), logout(), get_user_model(); –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–∞–≤–∞; –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># views.py
from django.contrib.auth import authenticate, login, logout, get_user_model
from django.contrib.auth.decorators import login_required, permission_required, user_passes_test
from django.shortcuts import render, redirect

User = get_user_model()

def login_view(request):
    if request.method == 'POST':
        user = authenticate(request, username=request.POST['username'], password=request.POST['password'])
        if user:
            login(request, user)
            return redirect('home')
    return render(request, 'login.html')

@login_required
def secret_view(request):
    return render(request, 'secret.html')

@permission_required('app.view_book', raise_exception=True)
def staff_view(request):
    ...

@user_passes_test(lambda u: u.is_superuser)
def only_superusers(request):
    ...


def logout_view(request):
    logout(request)
    return redirect('login')
</code></pre>
          </div>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># –†–∞–±–æ—Ç–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –∏ –≥—Ä—É–ø–ø–∞–º–∏
from django.contrib.auth.models import Permission, Group

edit_perm = Permission.objects.get(codename='change_book')
editors, _ = Group.objects.get_or_create(name='Editors')
editors.permissions.add(edit_perm)

user = User.objects.first()
user.groups.add(editors)

if user.has_perm('app.change_book'):
    print('–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å')
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π login/logout, –¥–æ—Å—Ç—É–ø –ø–æ –ø—Ä–∞–≤–∞–º/—Ä–æ–ª—è–º, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º.</div>
        </section>

        <!-- HTTP -->
        <section id="http" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">4. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTP</h2>
          <p class="text-slate-300 mb-4">HttpResponse, JsonResponse, FileResponse, StreamingHttpResponse, –º–µ—Ç–æ–¥—ã request, redirect(), reverse().</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.http import HttpResponse, JsonResponse, FileResponse, StreamingHttpResponse
from django.shortcuts import redirect
from django.urls import reverse

# –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
def hello(request):
    if request.method == 'GET':
        return HttpResponse('Hello, world!', content_type='text/plain')

# JSON
def api_data(request):
    data = {'ok': True, 'user': request.user.username if request.user.is_authenticated else None}
    return JsonResponse(data, status=200)

# –§–∞–π–ª –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
def download_manual(request):
    return FileResponse(open('/path/to/manual.pdf', 'rb'), as_attachment=True, filename='manual.pdf')

# –°—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
def stream_numbers(request):
    def gen():
        for i in range(5):
            yield f"{i}\n"
    return StreamingHttpResponse(gen(), content_type='text/plain')

# redirect + reverse
def go_home(request):
    return redirect(reverse('home'))
</code></pre>
            </div>
            <div class="section-card p-4">
              <h3 class="text-lg font-semibold text-amber-300 mb-2">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
              <ul class="list-disc list-inside text-slate-300 text-sm space-y-1">
                <li>HttpResponse –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö/HTML –æ—Ç–≤–µ—Ç–æ–≤</li>
                <li>JsonResponse –¥–ª—è API (safe=False –¥–ª—è —Å–ø–∏—Å–∫–æ–≤)</li>
                <li>FileResponse –¥–ª—è –æ—Ç–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ</li>
                <li>StreamingHttpResponse –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–ª–∏ ¬´–∂–∏–≤—ã—Ö¬ª –ø–æ—Ç–æ–∫–æ–≤</li>
                <li>redirect/reverse –¥–ª—è –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö URL –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Templates -->
        <section id="templates" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">5. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">render(), render_to_string(), –æ—Å–Ω–æ–≤–Ω—ã–µ template tags –∏ —Ñ–∏–ª—å—Ç—Ä—ã.</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># views.py
from django.shortcuts import render
from django.template.loader import render_to_string

def page(request):
    return render(request, 'page.html', {'title': 'Welcome'})

html = render_to_string('email.html', {'username': 'alice'})
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-xml">&lt;!-- template: base.html --&gt;
{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>{% block title %}Site{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/site.css' %}">
  </head>
  <body>
    {% block content %}{% endblock %}
  </body>
</html>

&lt;!-- template: page.html --&gt;
{% extends 'base.html' %}
{% block title %}{{ title|default:'Title' }}{% endblock %}
{% block content %}
  {% if user.is_authenticated %}
    <p>Hello, {{ user.username|upper }}!</p>
  {% else %}
    <p>Please log in.</p>
  {% endif %}
  <ul>
    {% for b in books %}
      <li>{{ b.title }} ‚Äî {{ b.price|floatformat:2 }}</li>
    {% empty %}
      <li>–ù–µ—Ç –∫–Ω–∏–≥</li>
    {% endfor %}
  </ul>
  {% include 'partials/pager.html' %}
  <form method="post">{% csrf_token %} ... </form>
{% endblock %}
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ HTML, email-—à–∞–±–ª–æ–Ω—ã, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–ª–æ–∫–∏, —Å—Ç–∞—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ {% static %}.</div>
        </section>

        <!-- URLs -->
        <section id="urls" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">6. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL</h2>
          <p class="text-slate-300 mb-4">path(), re_path(), include(), reverse(), get_absolute_url(), –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># urls.py
from django.urls import path, re_path, include
from . import views

urlpatterns = [
    path('', views.home, name='home'),
    path('book/<int:pk>/', views.book_detail, name='book-detail'),
    re_path(r'^search/(?P&lt;q&gt;.+)/$', views.search, name='search'),
    path('api/', include('app.api_urls')),
]

# models.py ‚Äî get_absolute_url
from django.urls import reverse
class Book(models.Model):
    ...
    def get_absolute_url(self):
        return reverse('book-detail', args=[self.pk])
</code></pre>
          </div>
          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># –ü—Ä–∏–º–µ—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–≤
# converters.py
class YearConverter:
    regex = '[0-9]{4}'
    def to_python(self, value): return int(value)
    def to_url(self, value): return f'{value:04d}'

# urls.py
from django.urls import register_converter
from .converters import YearConverter
register_converter(YearConverter, 'yyyy')
urlpatterns += [
    path('archive/<yyyy:year>/', views.archive, name='archive')
]
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã, reverse –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –∫–æ–¥–µ –∏ —à–∞–±–ª–æ–Ω–∞—Ö, include –¥–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.</div>
        </section>

        <!-- Sessions -->
        <section id="sessions" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">7. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏</h2>
          <p class="text-slate-300 mb-4">request.session —Å –º–µ—Ç–æ–¥–∞–º–∏ set/get/pop/flush/cycle_key.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">def set_session(request):
    request.session['theme'] = 'dark'
    request.session.set_expiry(3600)  # 1 —á–∞—Å
    return HttpResponse('ok')

def get_session(request):
    theme = request.session.get('theme', 'light')
    return JsonResponse({'theme': theme})

def pop_session(request):
    request.session.pop('theme', None)
    return HttpResponse('popped')

def reset_session(request):
    request.session.flush()  # —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –º–µ–Ω—è–µ—Ç –∫–ª—é—á
    request.session.cycle_key()
    return HttpResponse('flushed')
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–∫–æ—Ä–∑–∏–Ω—ã, flash-—Å–æ–æ–±—â–µ–Ω–∏—è.</div>
        </section>

        <!-- Cookies -->
        <section id="cookies" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">8. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Cookies</h2>
          <p class="text-slate-300 mb-4">set_cookie(), delete_cookie(), request.COOKIES.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">def set_cookie_view(request):
    resp = HttpResponse('cookie set')
    resp.set_cookie('lang', 'ru', max_age=7*24*3600, httponly=True, samesite='Lax')
    return resp

def get_cookie_view(request):
    lang = request.COOKIES.get('lang', 'en')
    return JsonResponse({'lang': lang})

def delete_cookie_view(request):
    resp = HttpResponse('cookie removed')
    resp.delete_cookie('lang')
    return resp
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Å–æ–≥–ª–∞—Å–∏—è (—É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∑–∞–∫–æ–Ω—ã –∏ –ø–æ–ª–∏—Ç–∏–∫—É –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏).</div>
        </section>

        <!-- Signals -->
        <section id="signals" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">9. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">pre_save, post_save, pre_delete, post_delete, m2m_changed, @receiver.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># signals.py
from django.db.models.signals import pre_save, post_save, pre_delete, post_delete, m2m_changed
from django.dispatch import receiver
from .models import Book

@receiver(pre_save, sender=Book)
def before_book_save(sender, instance, **kwargs):
    if instance.title:
        instance.title = instance.title.strip()

@receiver(post_save, sender=Book)
def after_book_save(sender, instance, created, **kwargs):
    if created:
        print('–°–æ–∑–¥–∞–Ω–∞ –∫–Ω–∏–≥–∞', instance.pk)

@receiver(pre_delete, sender=Book)
def before_book_delete(sender, instance, **kwargs):
    print('–£–¥–∞–ª—è–µ—Ç—Å—è –∫–Ω–∏–≥–∞', instance.pk)
</code></pre>
          </div>
          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mt-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># m2m_changed: –ø—Ä–∏–º–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from django.contrib.auth import get_user_model
from django.db.models.signals import m2m_changed
from django.dispatch import receiver

User = get_user_model()

@receiver(m2m_changed, sender=User.groups.through)
def user_groups_changed(sender, instance, action, reverse, model, pk_set, **kwargs):
    if action in {"post_add", "post_remove"}:
        print("–ì—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–µ–Ω—ã:", instance.pk, action, pk_set)
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (–∏–∑–±–µ–≥–∞–π—Ç–µ —Ç—è–∂—ë–ª–æ–π –ª–æ–≥–∏–∫–∏).</div>
        </section>

        <!-- Cache -->
        <section id="cache" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">10. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º</h2>
          <p class="text-slate-300 mb-4">cache.get/set/delete/clear, @cache_page, @vary_on_cookie().</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.core.cache import cache

# –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API
cache.set('homepage_html', '&lt;html&gt;...&lt;/html&gt;', timeout=300)
html = cache.get('homepage_html')
cache.delete('homepage_html')
cache.clear()
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.views.decorators.cache import cache_page
from django.views.decorators.vary import vary_on_cookie

@vary_on_cookie
@cache_page(60 * 5)  # 5 –º–∏–Ω—É—Ç
def cached_view(request):
    ...
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –¥–æ—Ä–æ–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã; –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–π—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π backend –∏ –∫–ª—é—á–∏.</div>
        </section>

        <!-- Logging -->
        <section id="logging" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">11. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
          <p class="text-slate-300 mb-4">logging.getLogger(), –º–µ—Ç–æ–¥—ã logger.debug/info/warning/error.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">import logging
from django.http import HttpResponse

logger = logging.getLogger(__name__)

def view(request):
    logger.info('User=%s path=%s', request.user, request.path)
    try:
        1 / 0
    except Exception:
        logger.exception('Unexpected error')
    return HttpResponse('ok')
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞, –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π, –æ—Ç–ª–∞–¥–∫–∞. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ settings.LOGGING.</div>
        </section>

        <!-- Files -->
        <section id="files" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">12. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏</h2>
          <p class="text-slate-300 mb-4">request.FILES, default_storage, FileSystemStorage, –ø—É—Ç–∏.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># forms.py
from django import forms

class UploadForm(forms.Form):
    file = forms.FileField()
</code></pre>
          </div>
          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># views.py
from django.core.files.storage import default_storage, FileSystemStorage
from django.conf import settings
from django.http import JsonResponse
from django.shortcuts import render
from .forms import UploadForm


def upload(request):
    if request.method == 'POST':
        form = UploadForm(request.POST, request.FILES)
        if form.is_valid():
            f = form.cleaned_data['file']
            # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ MEDIA_ROOT/ uploads/
            path = default_storage.save(f"uploads/{f.name}", f)
            return JsonResponse({'path': path})
    else:
        form = UploadForm()
    return render(request, 'upload.html', {'form': form})

# –ö–∞—Å—Ç–æ–º–Ω—ã–π FileSystemStorage
media_storage = FileSystemStorage(location=settings.MEDIA_ROOT, base_url=settings.MEDIA_URL)
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞, –¥–æ—Å—Ç—É–ø –∫ –ø—É—Ç—è–º MEDIA_ROOT/MEDIA_URL.</div>
        </section>

        <!-- JSON -->
        <section id="json" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">13. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON</h2>
          <p class="text-slate-300 mb-4">json.dumps()/loads(), JSONField, JsonResponse.</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">import json
from django.http import JsonResponse

# Python -&gt; JSON —Å—Ç—Ä–æ–∫–∞
s = json.dumps({'a': 1})
obj = json.loads(s)

# Django JsonResponse
return JsonResponse({'ok': True})
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python"># models.py ‚Äî JSONField
from django.db import models

class Profile(models.Model):
    user = models.OneToOneField('auth.User', on_delete=models.CASCADE)
    settings = models.JSONField(default=dict)
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–∏–±–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, API –æ—Ç–≤–µ—Ç—ã, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π.</div>
        </section>

        <!-- Migrations -->
        <section id="migrations" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">14. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏</h2>
          <p class="text-slate-300 mb-4">CreateModel, AddField, RemoveField, AlterField, RenameModel, RunPython.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># –ü—Ä–∏–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ RunPython
from django.db import migrations

def forwards(apps, schema_editor):
    Book = apps.get_model('app', 'Book')
    for b in Book.objects.filter(stock__lt=0):
        b.stock = 0
        b.save(update_fields=['stock'])

def backwards(apps, schema_editor):
    pass

class Migration(migrations.Migration):
    dependencies = [('app', '0001_initial')]
    operations = [
        migrations.RunPython(forwards, backwards),
    ]
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π.</div>
        </section>

        <!-- Admin -->
        <section id="admin" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">15. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Admin –ø–∞–Ω–µ–ª—å—é</h2>
          <p class="text-slate-300 mb-4">list_display, list_filter, search_fields, readonly_fields, inlines, actions.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># admin.py
from django.contrib import admin
from .models import Book, Order, OrderItem

class OrderItemInline(admin.TabularInline):
    model = OrderItem
    extra = 0

@admin.register(Book)
class BookAdmin(admin.ModelAdmin):
    list_display = ('id', 'title', 'author', 'price', 'stock')
    list_filter = ('author', 'category')
    search_fields = ('title', 'author__name')
    readonly_fields = ()
    actions = ['set_zero_stock']

    @admin.action(description='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ = 0')
    def set_zero_stock(self, request, queryset):
        queryset.update(stock=0)

@admin.register(Order)
class OrderAdmin(admin.ModelAdmin):
    inlines = [OrderItemInline]
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –≥—Ä—É–ø–ø–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ actions.</div>
        </section>

        <!-- i18n -->
        <section id="i18n" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">16. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
          <p class="text-slate-300 mb-4">gettext(), gettext_lazy(), activate(), get_language(), LANGUAGE_CODE, LANGUAGES.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">from django.utils.translation import gettext as _, gettext_lazy as _lazy
from django.utils.translation import activate, get_language

# –ü–µ—Ä–µ–≤–æ–¥ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
text = _('Hello')
# Lazy –ø–µ—Ä–µ–≤–æ–¥ (–≤ –º–æ–¥–µ–ª—è—Ö/—Ñ–æ—Ä–º–∞—Ö)
label = _lazy('Name')

activate('ru')
current = get_language()  # 'ru'
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, email –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</div>
        </section>

        <!-- Time -->
        <section id="time" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">17. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ –¥–∞—Ç–æ–π</h2>
          <p class="text-slate-300 mb-4">timezone.now(), DateField, DateTimeField, auto_now, auto_now_add.</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python">from django.utils import timezone
from django.db import models

class Event(models.Model):
    name = models.CharField(max_length=120)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    start_date = models.DateField()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
now = timezone.now()
upcoming = Event.objects.filter(start_date__gte=timezone.now().date())
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ç–∞–π–º–∑–æ–Ω—ã-aware –≤—Ä–µ–º—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.</div>
        </section>

        <!-- Testing -->
        <section id="testing" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">18. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
          <p class="text-slate-300 mb-4">TestCase, Client, RequestFactory, fixtures, @override_settings().</p>

          <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg mb-3">
            <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <pre><code class="language-python"># tests.py
from django.test import TestCase, Client, RequestFactory, override_settings
from django.urls import reverse
from .models import Book, Author

class ViewsTest(TestCase):
    fixtures = ['books.json']

    def setUp(self):
        self.client = Client()
        self.factory = RequestFactory()
        self.author = Author.objects.create(name='Tom')
        self.book = Book.objects.create(title='Django', author=self.author, price=10, stock=1)

    def test_home(self):
        resp = self.client.get(reverse('home'))
        self.assertEqual(resp.status_code, 200)

    @override_settings(DEBUG=True)
    def test_override(self):
        self.assertTrue(True)
</code></pre>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—å—é—Ö, –º–æ–¥–µ–ª–µ–π –∏ API; override_settings –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è.</div>
        </section>

        <!-- Serialization -->
        <section id="serialization" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">19. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
          <p class="text-slate-300 mb-4">serialize(), deserialize(), –∫–æ–º–∞–Ω–¥—ã dumpdata/loaddata.</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.core import serializers

# –í JSON
data = serializers.serialize('json', Book.objects.all())

# –û–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç—ã
for obj in serializers.deserialize('json', data):
    instance = obj.object
</code></pre>
            </div>
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-bash"># –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
python manage.py dumpdata app.Book --indent 2 &gt; books.json
python manage.py loaddata books.json
</code></pre>
            </div>
          </div>
          <div class="mt-2 text-slate-300 text-sm">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤.</div>
        </section>

        <!-- Utils -->
        <section id="utils" class="section-card p-6">
          <h2 class="text-2xl font-bold mb-2 text-sky-400">20. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã</h2>
          <p class="text-slate-300 mb-4">slugify(), mark_safe(), hashlib, secrets, apps, ContentType, import_string().</p>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="code-block relative bg-slate-900/50 border border-slate-800 rounded-lg">
              <button class="copy-btn absolute top-2 right-2 bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1 rounded">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <pre><code class="language-python">from django.utils.text import slugify
from django.utils.safestring import mark_safe
from django.contrib.contenttypes.models import ContentType
from django.apps import apps
from django.utils.module_loading import import_string
import hashlib, secrets

slug = slugify('–ü—Ä–∏–≤–µ—Ç –ú–∏—Ä!')  # privet-mir
safe_html = mark_safe('<b>–ù–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</b>')

# –•—ç—à–∏/—Å–µ–∫—Ä–µ—Ç—ã
sha = hashlib.sha256(b'data').hexdigest()
token = secrets.token_urlsafe(32)

# ContentType –∏ apps
ct = ContentType.objects.get_for_model(Book)
BookModel = apps.get_model('app', 'Book')

# import_string –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
klass = import_string('path.to.Class')
</code></pre>
            </div>
            <div class="section-card p-4">
              <h3 class="text-lg font-semibold text-amber-300 mb-2">–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
              <ul class="list-disc list-inside text-slate-300 text-sm space-y-1">
                <li>slugify –¥–ª—è URL-—Å–ª–µ–≥–æ–≤</li>
                <li>mark_safe —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ HTML</li>
                <li>hashlib/secrets –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ —Ç–æ–∫–µ–Ω–æ–≤</li>
                <li>apps/ContentType –¥–ª—è generic —Å–≤—è–∑–µ–π –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</li>
                <li>import_string –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π</li>
              </ul>
            </div>
          </div>
        </section>

      </main>
    </div>

    <footer class="mt-10 text-center text-slate-500 text-sm">
      Django 5.0+ ‚Äî –®–ø–∞—Ä–≥–∞–ª–∫–∞. –¢—ë–º–Ω–∞—è —Ç–µ–º–∞, Tailwind v4, highlight.js. –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.
    </footer>
  </div>

  <script>
    // highlight.js init
    hljs.highlightAll();

    // Copy code helper
    function textFromCodeButton(btn) {
      const pre = btn.parentElement.querySelector('pre');
      if (!pre) return '';
      return pre.innerText.replace(/\n$/, '');
    }
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const code = textFromCodeButton(btn);
        try {
          await navigator.clipboard.writeText(code);
          const prev = btn.textContent;
          btn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
          btn.classList.add('bg-emerald-700');
          setTimeout(() => { btn.textContent = prev; btn.classList.remove('bg-emerald-700'); }, 1600);
        } catch (e) {
          btn.textContent = '‚úó –û—à–∏–±–∫–∞';
        }
      })
    });

    // Smooth scroll for anchors
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', (e) => {
        const id = a.getAttribute('href');
        const target = document.querySelector(id);
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      })
    });

    // Active section highlight in TOC
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');
          document.querySelectorAll('#toc a').forEach(link => link.classList.remove('text-sky-400', 'font-semibold'));
          const active = document.querySelector(`#toc a[href="#${id}"]`);
          if (active) { active.classList.add('text-sky-400', 'font-semibold'); }
        }
      })
    }, { rootMargin: '-20% 0px -70% 0px' });
    document.querySelectorAll('section[id]').forEach(sec => observer.observe(sec));
  </script>
</body>
</html>
